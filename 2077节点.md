# 游戏核心功能分析表
| 分析类别 | 核心子项 | 功能说明 | 典型案例/补充信息 | 特点 | 后续关注 | 关注度(ing) | Pin(默认3) |
| --- | --- | --- | --- | --- | --- | --- | --- |
| **Quest Logic (任务逻辑)** | Input (输入节点) | 具备自触发功能，触发后通过判断输出不同结果，关联后续Output节点 | - | - | - | - | - |
| | Scene (场景节点) | 含不同输入输出引脚，在Quest Flow中，不同背景进入通过不同引脚进入同一Scene Cut，使Cut产生不同变化 | - | - | - | - | - |
| | Pause (任务停顿节点) | 用于任务判断和任务目标驱动，可按时间(Period)、距离(distance)等条件触发停顿 | 1. 时间判断：“寻找Evelyn”任务中，玩家仅晚上可进入酒吧，白天会被拒绝；2. 距离判断：按distance判断场景是否清空 | - | - | - | - |
| | Condition (流程判断节点) | 任务流程中的判断环节，可通过判断Fact变化改变后续选择，支持在任务系统中直接添加流程判断 | 任务开始时判断是否为新游戏；通过添加自设Fact作为Condition判断依据，实验证明可行 | 直接在Flow Quest流程中添加 | - | - | 多如单出、动态增减 |
| | Cut Control (切割控制节点) | 对不同进入的任务内容分类，玩家选择会对后续内容产生短期或持久影响 | 1. 短期影响：玩家潜入/杀光小怪完成任务，对之前Scene场景中小怪状态有影响；2. 持久影响：潜入救人后潜行离开，之前场景小怪不再刷新 | 二选一 | - | - | - |
| | Fact Manager (事实控制节点) | 管理游戏中的特定状态信息(记录当前存在和已发生的内容)，控制游戏内元素的具体属性，作为hub信息传递中间载体，链接UI与HUD，实现不同任务完成时有不同信息反馈，支持一个事件触发多目标或多事件对照同一目标 | 任务完成后UI变化同步链接HUD；一个事件可同时触发多种目标，多个事件可对照同一目标 | - | - | - | - |
| | Switch (切换节点) | - | - | - | - | *** | - |
| | Fact (状态信息记录) | 记录游戏特定状态(当前存在和已发生)，为Condition提供判断依据，确保玩家选择与行为在游戏世界产生可感知反馈 | 未完成的quest过程中，可能存在开发时计划添加后取消的选择(标注X号)；便利获取玩家选择和世界已发生的具体改变 | - | - | **** | - |
| | Randomizer (随机节点) | 功能暂未明确找到相关信息 | - | - | - | * | - |
| | And&Or (逻辑节点) | 实现任务逻辑中的与或逻辑判断，辅助构建复杂任务流程 | 一个事件信息同时触发多种新的结果、多个事件触发同一事件目标 | 可添加 | - | *** | - |
| | Phase (阶段节点) | 将部分Flow封装到另一个资产中，便于团队协作和调试观察 | - | 封装到了另一个资产 | - | ***** | 动态加减 |
| | Hub | 信息传递中间载体 | - | - | - | **** | - |
| **Game Play (游戏内容)** | Character Manager (角色管理器) | 管理角色相关设置，包括生成AI及配置AI属性 | “威尔逊拿枪任务”中，Spawn出AI与玩家进行打靶子比赛，并设置生成AI的属性 | - | - | - | - |
| | Crowd (人群管理器) | 管理游戏中的人群，玩家完成任务后可根据distance清除相应人群 | - | - | - | - | - |
| | Interactive Object Manager (交互物体管理器) | 控制场景交互对象，需获取Scene中交互物体的Global Name，可添加特定交互功能 | 在Smoke Test中添加功能：扫描敌人后关闭Door、关闭收音机 | Flow直接管理场景中的可交互物体 | - | **** | - |
| | Item Manager (物件管理器) | 管理游戏内物件，如添加门禁卡等道具 | AI持有门禁卡 | 添加玩家身上持有物 | - | * | - |
| | Mini game (小游戏) | 游戏内的小型游戏环节，通常与任务或奖励关联 | 《赛博朋克2077》中有一种街机小游戏算彩蛋 | - | - | * | - |
| | Reward (奖励系统) | 玩家完成任务后提供奖励，包括物品、NPC反馈等 | “拿枪任务”完成后玩家获得相应回报；任务完成后NPC给出奖励内容；潘安给任务奖品，玩家捡起奖品继续任务 | - | - | ** | - |
| | Spawn Manager (生成管理器) | 管理场景中物体(AI、NPC、车辆等)的生成，生成工具需Build game设置，资产引用含生成物体信息，不同索引/位置生成内容不同 | 1. 生成AI：Spawn资产含多种AI类型(各帮派、公司、NPC)，索引不同生成内容不同；2. 生成对话：Spawn杰克对话；3. 生成车辆：市中心车辆多为未改装，帮派领地车辆多为改装车，且不同帮派领地改装风格不同 | 包含另一个资产的引用，生成该资产中的相关AI、车辆、可生成物体，本身 | - | **** | - |
| | Event Manager (事件管理器) | 集合多种事件控制器，不同管理器用彩色标记区分，管理游戏内各类事件 | - | 是多种管理器的集合(玩家提示、灯光管理.....) | - | **** | - |
| | Transform Animation (变体动画) | 控制玩家或者NPC的变体动画 | - | - | - | - | - |
| | Trigger Manager (目标管理) | - | - | - | - | - | - |
| | Vision Model (视觉管理) | 特殊的渲染 | - | - | - | - | - |
| | Achievement (成就、等级管理) | 街头声望等 | - | - | - | - | - |
| | Audio Character Manager (音频角色管理器) | 管理与角色相关的音频设置 | 《赛博朋克2077》“机械与人格”任务中，玩家上车后强制播放悲伤音乐 | - | - | - | - | - |
| | Game Manager (游戏管理器) | 管理游戏关键进程，如联系人添加、Save点设置等 | 1. 联系人管理：玩家第一次从酒吧离开，Hands第一次打电话后，添加新联系人；2. Save点设置：巫毒帮战斗场景设置Save点 | - | - | - | - | - |
| **核心游戏管理功能** | FX (特效管理器) | 管理游戏内特效效果 | - | - | - | - | - |
| | Render (渲染管理器) | 管理游戏画面渲染 | - | - | - | - | - |
| | Teleport (快速移动) | 提供游戏内快速移动功能 | - | - | - | - | - |
| | Time Manager (时间管理器) | 管理游戏内时间系统，含时间管理Demo | - | - | - | - | - |
| **World Data (世界数据)** | AI 相关 | 包含Combat、AI Manager、AI Attitude、Shoot At等功能，控制AI战斗行为 | 玩家伤害NPC时触发AI战斗(爆发战斗) | - | - | - | - |
| | Vehicle (车辆管理) | 管理车辆相关功能，包括车辆追逐、车辆移动控制、战后武器处理 | 1. 车辆移动：通过Vehicle Move控制车辆沿Spline移动；2. 战后处理：车辆追逐战后，NPC去除武器 | - | - | - | - |
| | Equip Item (装备物品) | 管理角色装备物品功能 | - | - | - | - | - |
| | Use Workspot (工作点使用) | 支持快速(immediate)使用工作点功能 | - | - | - | - | - |
| **UI (用户界面)** | Journal (日志系统) | 管理任务日志，定义资产，控制场景UI地标和玩家任务列表内容，不影响任务执行顺序 | 《赛博朋克2077》“机械与人格”任务中，每辆车子对应不同任务内容(开车回去、打玩偶、打小帮派成员等)；2. 添加自有Journal会在UI、地图显示相应内容，但不改变任务执行顺序 | - | - | - | - |
| | 地图UI | 通过地图UI资产配置Toolkit配置，含地图标记点(如fa_tst地图上的U标记点) | - | 一个资产的引用，其中包含相应的UI在地图上的位置锚点等信息 | - | - | - |
| | Mapping Manager (映射管理器) | 管理UI与游戏内元素的映射关系，支持在Journal中发送消息(Send Massage) | 日志、地图、信息等UI系统配置在集合资产中 | - | - | - | 4入1出(Active、Inactive、Succeed、Failed) |
| **Scene (场景)** | Scene 核心组件 | 含手机系统、记录系统、场景、语音系统，区分LD和QD，对话选择会影响后续剧情，部分含Sequence内容(播放过场) | 1. 和NPC对话后，选择是否表现敌意会影响后续剧情；2. 部分Scene含Sequence内容，播放一小段过场 | - | - | - | - |
| | Scene 文件 | 包含多种类型文件，如SCENE文件、SCENESOLUTION文件、SCNLOCJSON文件、PREFAB文件等，存在部分资产打开崩溃问题 | 示例文件：q105_03b_dollhouse_tom.scene(279KB)、q105_03b_dollhouse_tom.scenesolution(541KB)等 | - | - | - | - |
| | Scene Manager (场景管理器) | 管理场景相关操作，如玩家完成任务获得奖励后，添加发放的武器 | - | - | - | - | - |
| | Phone Manager | 手机管理、消息接受玩家主动Call，玩家被动Call | - | - | - | - | - |
| | Record | 推测包含在Scene组件中，调试时仅Scene亮起来可佐证 | - | - | - | - | - |
| | RenderManage (渲染管理) | - | - | - | - | - | - |
| | Voiceset Manager (语音集管理器) | 语音集合管理器 | - | - | - | - | - |
| | Work Spot | - | - | - | - | - | - |
| **Help Objects** | Comment | 命令 | - | - | - | - | - |
| | Note | 注释 | - | - | - | - | - |
| **AI** | Combat | 战斗、Look At、Shot At…… | - | - | - | - | - |
| | AI Manager | - | - | - | - | - | - |
| | AI Attitude | AI属性 | - | - | - | - | - |
| **Vehicle 管理** | Vehicle Move 车辆移动 | 车辆追逐、车辆损毁、车辆跟随；车辆规律化运动、车辆沿样条线移动 | - | - | - | - | - |
| | Equip Item 装备物体 | 战斗后AI卸下武器 | - | - | - | - | - |
| | immediate 快速 | 快速移动? | - | - | - | - | - |
| | Use Work spot | - | - | - | - | - | - |
| | Move | AI移动 | - | - | - | - | - |
| **Multi player (多人游戏)** | 多人游戏相关 | 暂未明确具体功能细节，仅提及该类别 | - | - | - | - | - |
| **杂项** | 本地化字幕 | 存储游戏本地化字幕，含特定存储位置和格式 | - | - | - | - | - |


| 层级名称               | 包含内容                                                                 |
|------------------------|--------------------------------------------------------------------------|
| TweakDB 配置层 (Data-Driven) | - AIAction Records<br>- AICondition Records<br>- AITarget Records       |
| 行为树层 (Behavior Tree Layer) | - Tree Nodes (决策、条件、动作)<br>- Behavior Instance (实例管理)<br>- Execution Context (执行上下文) |
| 命令队列层 (Command Queue Layer) | - Command System (命令系统)<br>- Context Management (上下文管理)<br>- Priority Handling (优先级处理) |
| 动作执行层 (Action Execution Layer) | - Movement Actions (移动)<br>- Drive Actions (驾驶)<br>- Combat Actions (战斗)<br>- Animation Actions (动画) |

    ┌─────────────────────────────────────────────────────┐
    │         TweakDB 配置层 (Data-Driven)                 │
    │  - AIAction Records                                 │
    │  - AICondition Records                              │
    │  - AITarget Records                                 │
    └──────────────────┬──────────────────────────────────┘
                       │
    ┌──────────────────▼──────────────────────────────────┐
    │      行为树层 (Behavior Tree Layer)                  │
    │  - Tree Nodes (决策、条件、动作)                     │
    │  - Behavior Instance (实例管理)                     │
    │  - Execution Context (执行上下文)                   │
    └──────────────────┬──────────────────────────────────┘
                       │
    ┌──────────────────▼──────────────────────────────────┐
    │      命令队列层 (Command Queue Layer)                │
    │  - Command System (命令系统)                        │
    │  - Context Management (上下文管理)                  │
    │  - Priority Handling (优先级处理)                   │
    └──────────────────┬──────────────────────────────────┘
                       │
    ┌──────────────────▼──────────────────────────────────┐
    │      动作执行层 (Action Execution Layer)             │
    │  - Movement Actions (移动)                          │
    │  - Drive Actions (驾驶)                             │
    │  - Combat Actions (战斗)                            │
    │  - Animation Actions (动画)                         │
    └─────────────────────────────────────────────────────┘




---  
# 列出所有 questphase 中的所有节点


  # 切换到目录
  cd /d D:\AppSoft\Sy2077\2077\2077\CDPR2077\bin\x64_DLL.Release

  # 扫描所有 questphase 文件，列出所有节点
   resourcesScan -questphases -mode=allNodes -output=D:\quest_all_nodes.json -pretty

  # 或者只扫描特定目录（更快）
  cmdlet.exe resourcesScan -questphases -mode=allNodes -scanBasePath=base\quest\side_quests\sq004 -output=D:\sq004_nodes.json -pretty


# 列出所有 SceneSolution 中的所有节点
  cmdlet.exe resourcesScan -sceneSolutions -quests -mode=detailedNodes -output=D:\AppSoft\Sy2077\ResourceWrite\scene_detailed.json -pretty
  cmdlet.exe resourcesScan -sceneSolutions -mode=detailedNodes -output=D:\Result\Empty_scenes.json -pretty -scanBasePath=base\quest\testgym (只输出动画和Workspot)
  cmdlet.exe resourcesScan -sceneSolutions -quests -mode=detailedNodes -output=D:\Result\Empty_Questscenes.json -pretty -scanBasePath=base\quest\testgym ( 输出Actor和其他信息全面)


  1. 重新编译 backendPipeline 项目
  2. 重新编译 cmdlet 项目（依赖 backendPipeline）
  3. 运行命令：
  cmdlet.exe resourcesScan -sceneSolutions -quests -mode=detailedNodes -output=D:\scene_detailed.json -pretty
# 列出所有 SceneSolution 中的所有节点

cmdlet.exe resourcesScan -sceneSolutions -quests -mode=sectionTracksClips -output=D:\Result\QEmpthresult.json -scanBasePath=base\quest\testgym

# 分Section分Animation

  cmdlet.exe resourcesScan -sceneSolutions -quests -mode=full -output=D:\Result\Full_Questscenes.json -pretty -scanBasePath=base\quest\testgym



   cmdlet.exe resourcesScan -output=D:\Result\scenesAllNodeAndTrack.json -sceneSolutions -mode=MODE_FULL -scanBasePath=base\quest\testgym -pretty
# Full问题

  cmdlet.exe resourcesScan -sceneSolutions -quests -mode=full -output=D:/Result/Empty_QuestscenesAll_Full.json -pretty -scanBasePath=base/quest/testgym
