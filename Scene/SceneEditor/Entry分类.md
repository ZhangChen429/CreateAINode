# WorkspotTree IEntry èŠ‚ç‚¹ç±»å‹å®Œå…¨æŒ‡å—
## ä¸€ã€å®¹å™¨èŠ‚ç‚¹ï¼ˆContainer Entriesï¼‰
å®¹å™¨èŠ‚ç‚¹ç”¨äºç»„ç»‡å’Œæ§åˆ¶å…¶ä»–èŠ‚ç‚¹çš„æ‰§è¡Œæµç¨‹ï¼Œ**ä¸ç›´æ¥æ’­æ”¾åŠ¨ç”»**ï¼Œæ˜¯æ•´ä¸ªè¡Œä¸ºæ ‘çš„éª¨æ¶æ ¸å¿ƒã€‚

### 1. Sequenceï¼ˆé¡ºåºåºåˆ—ï¼‰
- **å›¾æ ‡**ï¼šğŸŸ¢ ç»¿è‰²åŒç®­å¤´
- **æ ¸å¿ƒç”¨é€”**ï¼šæŒ‰ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œæ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæ”¯æŒæ— é™å¾ªç¯ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class Sequence : public IContainerEntry
{
    red::DynArray<THandle<IEntry>> m_list;  // å­èŠ‚ç‚¹åˆ—è¡¨
    Bool m_loopInfinitely;                  // æ˜¯å¦æ— é™å¾ªç¯
    CName m_idleAnim;                       // å®¹å™¨çš„ idle åŠ¨ç”»
};
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… ä½œä¸º `Root sequence` æ‰¿è½½æ•´ä¸ª Workspot çš„ä¸»é€»è¾‘
  âœ… å°†å¤æ‚è¡Œä¸ºæ‹†åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼ŒæŒ‰æ­¥éª¤æ‰§è¡Œ
  âœ… è®¾ç½® `m_loopInfinitely = true` åˆ›å»ºæ°¸ä¹…å¾ªç¯çš„å¾…æœºè¡Œä¸º
- **å®é™…ç¤ºä¾‹**
```
Sequence (idle: hanako_sit_barstool_bar_lean90__rh_on_bar_legs_crossed_01)
â”œâ”€ Random list  â† ç¬¬1æ­¥ï¼šéšæœºæ’­æ”¾åŠ¨ä½œ
â”œâ”€ Pause        â† ç¬¬2æ­¥ï¼šæ‰§è¡Œæš‚åœ
â””â”€ Random list  â† ç¬¬3æ­¥ï¼šå†æ¬¡éšæœºæ’­æ”¾åŠ¨ä½œ
```

---

### 2. RandomListï¼ˆéšæœºåˆ—è¡¨ï¼‰
- **å›¾æ ‡**ï¼šğŸ² ç»¿è‰²éšæœºç¬¦å·
- **æ ¸å¿ƒç”¨é€”**ï¼šä»å­èŠ‚ç‚¹åˆ—è¡¨ä¸­**éšæœºé€‰æ‹©ä¸€ä¸ª/å¤šä¸ª**èŠ‚ç‚¹æ‰§è¡Œï¼Œæ”¯æŒæƒé‡é…æ¯”ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class RandomList : public IContainerEntry
{
    red::DynArray<THandle<IEntry>> m_list;  // å­èŠ‚ç‚¹åˆ—è¡¨
    red::DynArray<Float> m_weights;         // æƒé‡ï¼ˆå¯é€‰ï¼Œæ•°å€¼è¶Šå¤§è§¦å‘æ¦‚ç‡è¶Šé«˜ï¼‰
    Uint32 m_minClips;                      // æœ€å°‘æ’­æ”¾æ•°é‡
    Uint32 m_maxClips;                      // æœ€å¤šæ’­æ”¾æ•°é‡
};
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… ä»å¤šä¸ªåŠ¨ç”»å˜ä½“ä¸­éšæœºé€‰æ‹©æ’­æ”¾ï¼ˆå¦‚ä¸åŒçš„æŠ½çƒŸ/å–æ°´åŠ¨ä½œï¼‰
  âœ… æƒé‡æ§åˆ¶è¡Œä¸ºæ¦‚ç‡ï¼Œè®©éƒ¨åˆ†åŠ¨ä½œçš„è§¦å‘é¢‘ç‡æ›´é«˜
  âœ… é…ç½®éšæœºæ’­æ”¾æ•°é‡ï¼Œæ¯æ¬¡æ‰§è¡Œ1~3ä¸ªä¸åŒåŠ¨ä½œ
- **å®é™…ç¤ºä¾‹**
```
Random list
â”œâ”€ Anim: johnny__stand__lh_cigarette__aggressive_01__puff_01    (æƒé‡: 0.5)
â”œâ”€ Anim: johnny__stand__lh_cigarette__aggressive_01__puff_02    (æƒé‡: 0.3)
â””â”€ Anim: johnny__stand__lh_cigarette__aggressive_01__puff_03    (æƒé‡: 0.2)
```

---

### 3. ReactionSequenceï¼ˆååº”åºåˆ—ï¼‰
- **å›¾æ ‡**ï¼šğŸŸ£ ç´«è‰²åŒç®­å¤´
- **æ ¸å¿ƒç”¨é€”**ï¼šå“åº”æ¸¸æˆå†…**ç‰¹å®šäº‹ä»¶**è§¦å‘çš„ä¸“å±è¡Œä¸ºåºåˆ—ï¼Œç»§æ‰¿ Sequence åŸºç¡€èƒ½åŠ›ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class ReactionSequence : public Sequence
{
    red::DynArray<game::data::RecordID> m_reactionTypes;  // ååº”ç±»å‹åˆ—è¡¨
    CName m_idleAnim;                                     // ååº”åçš„å¾…æœºå§¿åŠ¿
};
```
- **æå–çš„æ ¸å¿ƒååº”ç±»å‹**
  - `[BumpRightBack]` - ä»å³åæ–¹è¢«ç¢°æ’
  - `[BumpLeftBack]` - ä»å·¦åæ–¹è¢«ç¢°æ’
  - `[BumpRightFront]` - ä»å³å‰æ–¹è¢«ç¢°æ’
  - `[BumpLeftFront]` - ä»å·¦å‰æ–¹è¢«ç¢°æ’
  - `[Fear]` - ææƒ§æƒ…ç»ªè§¦å‘çš„ååº”
- **ä½¿ç”¨åœºæ™¯**
  âœ… NPC è¢«ç©å®¶/å…¶ä»–è§’è‰²ç‰©ç†ç¢°æ’çš„åé¦ˆåŠ¨ä½œ
  âœ… è§’è‰²å—åˆ°æƒŠå“ã€å¨èƒçš„æƒ…ç»ªååº”
  âœ… æˆ˜æ–—åœºæ™¯ä¸­è¢«æ”»å‡»ã€å—ä¼¤çš„æˆ˜æ–—ååº”
- **å®é™…ç¤ºä¾‹**
```
Root sequence
â”œâ”€ Reaction Sequence: idle: <no_auto_transition> [BumpRightBack]
â”‚  â””â”€ Sequence (idle: stand_2h_on_sides_01)
â”‚     â””â”€ Anim: stand_2h_on_sides_01_bump_back_right
â”‚
â”œâ”€ Reaction Sequence: idle: <no_auto_transition> [BumpLeftBack]
â”‚  â””â”€ ...
```
- **è§¦å‘é€»è¾‘ï¼ˆæ¸¸æˆä»£ç å‚è€ƒï¼‰**
```cpp
void OnNPCBumped(NPC* npc, Vector3 bumpDirection)
{
    CName reactionType = DetermineBumpReaction(bumpDirection);  // åˆ¤å®šç¢°æ’æ–¹å‘ â†’ "BumpRightBack"
    WorkspotInstance* workspot = npc->GetActiveWorkspot();
    workspot->TriggerReaction(reactionType);  // è§¦å‘å¯¹åº”ååº”åºåˆ—
}
```

---

### 4. ConditionalSequenceï¼ˆæ¡ä»¶åºåˆ—ï¼‰
- **å›¾æ ‡**ï¼šğŸ”µ è“è‰²æ¡ä»¶ç¬¦å·
- **æ ¸å¿ƒç”¨é€”**ï¼š**ä»…å½“æ»¡è¶³æŒ‡å®šæ¡ä»¶æ—¶**ï¼Œæ‰ä¼šæ‰§è¡Œå†…éƒ¨çš„å­èŠ‚ç‚¹åºåˆ—ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class ConditionalSequence : public Sequence
{
    red::DynArray<THandle<IWorkspotCondition>> m_conditionList;  // æ¡ä»¶åˆ—è¡¨
};
```
- **å¸¸è§æ¡ä»¶ç±»å‹**
```cpp
// æ—¶é—´æ¡ä»¶ - ä»…åœ¨æŒ‡å®šæ—¶æ®µæ‰§è¡Œ
class TimeOfDayCondition : public IWorkspotCondition
{
    Float m_startHour;  // èµ·å§‹å°æ—¶ 6.0
    Float m_endHour;    // ç»“æŸå°æ—¶ 22.0
};

// å¤©æ°”æ¡ä»¶ - åŒ¹é…æŒ‡å®šå¤©æ°”æ—¶æ‰§è¡Œ
class WeatherCondition : public IWorkspotCondition
{
    CName m_weather;  // "rain", "sunny", "foggy"
};

// å…³ç³»æ¡ä»¶ - æ»¡è¶³å¥½æ„Ÿåº¦é˜ˆå€¼æ—¶æ‰§è¡Œ
class RelationshipCondition : public IWorkspotCondition
{
    Float m_minFriendship;  // éœ€è¦çš„æœ€ä½å¥½æ„Ÿåº¦
};
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… æ—¶é—´ç›¸å…³è¡Œä¸ºï¼šæ—©æ™¨å–å’–å•¡ã€å¤œæ™šå–é…’ã€æ·±å¤œç¡è§‰
  âœ… å¤©æ°”ç›¸å…³è¡Œä¸ºï¼šä¸‹é›¨æ’‘ä¼ã€æ™´å¤©æ™’å¤ªé˜³ã€å¤§é›¾æ…¢è¡Œ
  âœ… å‰§æƒ…ç›¸å…³è¡Œä¸ºï¼šç‰¹å®šä»»åŠ¡é˜¶æ®µã€è§’è‰²å¥½æ„Ÿè¾¾æ ‡åçš„ä¸“å±åŠ¨ä½œ
- **ç¤ºä¾‹ç»“æ„**
```
ConditionalSequence
â”œâ”€ Condition: TimeOfDay(6:00-12:00)
â””â”€ Sequence
   â””â”€ Anim: sit_eat_breakfast  â† ä»…åœ¨æ—©æ™¨æ’­æ”¾è¯¥åŠ¨ç”»
```

---

### 5. Selectorï¼ˆé€‰æ‹©å™¨ï¼‰
- **æ ¸å¿ƒç”¨é€”**ï¼šæ ¹æ®é¢„è®¾æ¡ä»¶æˆ–è¯„åˆ†æœºåˆ¶ï¼Œ**é€‰æ‹©æœ€åˆé€‚çš„ä¸€ä¸ªåˆ†æ”¯**æ‰§è¡Œï¼Œè€Œéçº¯éšæœºã€‚
- **ä¸ RandomList çš„æ ¸å¿ƒåŒºåˆ«**
  â¡ RandomListï¼šæ— è§„åˆ™çš„**çº¯éšæœºé€‰æ‹©**ï¼Œæ— ä¼˜å…ˆçº§
  â¡ Selectorï¼šæœ‰è§„åˆ™çš„**æ™ºèƒ½é€‰æ‹©**ï¼ŒæŒ‰æ¡ä»¶/ä¼˜å…ˆçº§åŒ¹é…æœ€ä¼˜è§£
- **ä½¿ç”¨åœºæ™¯**
  âœ… æ ¹æ®ç¯å¢ƒçŠ¶æ€é€‰æ‹©åˆé€‚è¡Œä¸ºï¼ˆå¦‚å‘¨å›´æœ‰äººåˆ™å®‰é™ã€æ— äººåˆ™èˆ’å±•ï¼‰
  âœ… æŒ‰ä¼˜å…ˆçº§å°è¯•è¡Œä¸ºåˆ†æ”¯ï¼ˆå¦‚ä¼˜å…ˆåä¸‹ï¼Œæ¤…å­è¢«å åˆ™ç«™ç«‹ï¼‰
  âœ… å¤šå¥—è¡Œä¸ºæ–¹æ¡ˆçš„å…œåº•é€‰æ‹©

---

## äºŒã€å¶å­èŠ‚ç‚¹ï¼ˆLeaf Entriesï¼‰
å¶å­èŠ‚ç‚¹æ˜¯è¡Œä¸ºæ ‘çš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œ**ç›´æ¥æ’­æ”¾åŠ¨ç”»/æ‰§è¡Œå…·ä½“åŠ¨ä½œ**ï¼Œ**ä¸åŒ…å«ä»»ä½•å­èŠ‚ç‚¹**ã€‚

### 6. AnimClipï¼ˆåŠ¨ç”»ç‰‡æ®µï¼‰
- **å›¾æ ‡**ï¼šğŸŸ¢ ç»¿è‰²åœ†ç‚¹
- **æ ¸å¿ƒç”¨é€”**ï¼šæ’­æ”¾è§’è‰²çš„**åŸºç¡€åŸåœ°åŠ¨ç”»ç‰‡æ®µ**ï¼Œè§’è‰²ä¸–ç•Œä½ç½®ä¸å‘ç”Ÿæ”¹å˜ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class AnimClip : public IEntry
{
    CName m_animName;     // åŠ¨ç”»èµ„æºåç§°
    CName m_idleAnim;     // åŠ¨ç”»ç»“æŸååˆ‡å›çš„å¾…æœºå§¿åŠ¿
    Float m_blendInTime;  // åŠ¨ç”»æ··å…¥è¿‡æ¸¡æ—¶é—´
    Float m_blendOutTime; // åŠ¨ç”»æ··å‡ºè¿‡æ¸¡æ—¶é—´
};
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… åŸºç¡€å¾…æœºå¾ªç¯ï¼šåç€ã€ç«™ç€ã€å€šé çš„é™æ€ idle
  âœ… å•æ¬¡å˜ä½“åŠ¨ä½œï¼šæŒ å¤´ã€æ‰çœ¼ç›ã€è€¸è‚©ã€å¹æ°”ã€å–æ°´
  âœ… æ— ä½ç§»çš„äº¤äº’åŠ¨ä½œï¼šç‚¹å¤´ã€æ‘‡å¤´ã€æ‘†æ‰‹ç¤ºæ„
- **åŠ¨ç”»æ’­æ”¾å®Œæ•´æµç¨‹**
  1. å½“å‰æ’­æ”¾çš„åŠ¨ç”»æŒ‰ `m_blendOutTime` å®Œæˆæ··å‡º
  2. ç›®æ ‡åŠ¨ç”»æŒ‰ `m_blendInTime` å®Œæˆæ··å…¥è¿‡æ¸¡
  3. å®Œæ•´æ’­æ”¾ `m_animName` å¯¹åº”çš„åŠ¨ç”»ç‰‡æ®µ
  4. åŠ¨ç”»ç»“æŸåï¼Œè‡ªåŠ¨åˆ‡å› `m_idleAnim` å¾…æœºå§¿åŠ¿
- **å®é™…ç¤ºä¾‹**
```
Anim: hanako__sit_barstool_bar_lean90__rh_on_bar_legs_crossed_01__sip_drink_01
```
> è¯­ä¹‰è§£æï¼šHanako ååœ¨å§å°æ¤…ã€èº«ä½“å³å€¾90Â°ã€å³æ‰‹æ­å§å°ã€åŒè…¿äº¤å‰ â†’ æ‰§è¡Œå–ä¸€å£é…’çš„åŠ¨ä½œ

---

### 7. MotionAnimClipï¼ˆè¿åŠ¨åŠ¨ç”»ç‰‡æ®µï¼‰
- **å›¾æ ‡**ï¼šğŸŸ  æ©™è‰²åœ†ç‚¹
- **æ ¸å¿ƒç”¨é€”**ï¼šæ’­æ”¾**å¸¦æ ¹è¿åŠ¨ï¼ˆRoot Motionï¼‰** çš„åŠ¨ç”»ï¼ŒåŠ¨ç”»æœ¬èº«åŒ…å«ä½ç§»æ•°æ®ï¼Œä¼š**çœŸå®æ”¹å˜è§’è‰²åœ¨ä¸–ç•Œç©ºé—´ä¸­çš„ä½ç½®**ã€‚
- **ä¸ AnimClip çš„æ ¸å¿ƒåŒºåˆ«**
  â¡ AnimClipï¼š**åŸåœ°æ’­æ”¾**ï¼Œè§’è‰²åæ ‡ä¸å˜ï¼Œä»…éª¨éª¼åŠ¨ç”»é©±åŠ¨
  â¡ MotionAnimClipï¼š**å¸¦ä½ç§»æ’­æ”¾**ï¼Œè§’è‰²åæ ‡åŒæ­¥æ›´æ–°ï¼ŒåŠ¨ç”»+ä½ç§»åŒé©±åŠ¨
- **ä½¿ç”¨åœºæ™¯**
  âœ… å¯¹è¯ä¸­çš„å°å¹…åº¦æ­¥ä¼ï¼šå‘å‰åŠæ­¥å‡‘è¿‘ã€å‘åä¸€æ­¥è¿œç¦»ã€ä¾§æ­¥è°ƒæ•´ç«™ä½
  âœ… æ— ç›®æ ‡çš„å°å¹…ç§»åŠ¨ï¼šåŸåœ°è¸±æ­¥ã€é‡å¿ƒè½¬ç§»ã€è½¬èº«è°ƒæ•´æœå‘
  âœ… è¿‡æ¸¡ç±»ä½ç§»åŠ¨ä½œï¼šä»ç«™å§¿åˆ°åå§¿çš„èº«ä½“ä¸‹æ²‰ã€ä»åå§¿åˆ°ç«™å§¿çš„èµ·èº«å‰ç§»
- **å®é™…ç¤ºä¾‹**
```
Motion anim: johnny__stand__lh_cigarette__aggressive_01__conversation_step_01
```
> è¯­ä¹‰è§£æï¼šJohnny æŒæªè­¦æˆ’ç«™å§¿ã€å·¦æ‰‹å¤¹çƒŸ â†’ å¯¹è¯ä¸­å‘å‰è¿ˆæ­¥çš„å¸¦ä½ç§»åŠ¨ä½œ
- **æŠ€æœ¯å®ç°æ ¸å¿ƒé€»è¾‘**
```cpp
void WorkspotInstance::PlayMotionAnim(CName animName)
{
    Vector3 rootMotionDelta = ExtractRootMotion(animName); // æå–åŠ¨ç”»å†…ç½®çš„ä½ç§»æ•°æ®
    m_animComponent->PlayAnimation(animName);              // æ’­æ”¾åŠ¨ç”»
    m_actor->MoveBy(rootMotionDelta);                      // åŒæ­¥æ›´æ–°è§’è‰²ä¸–ç•Œåæ ‡
}
```

---

### 8. EntryAnimï¼ˆå…¥åœºåŠ¨ç”»ï¼‰
- **å›¾æ ‡**ï¼šğŸŸ¢ ç»¿è‰²æ˜Ÿæ˜Ÿï¼ˆå¤šæ–¹å‘ç®­å¤´æ ·å¼ï¼‰
- **æ ¸å¿ƒç”¨é€”**ï¼šè§’è‰²**ä»å¤–éƒ¨ä»»æ„çŠ¶æ€ â†’ è¿›å…¥å½“å‰ Workspot** çš„è¿‡æ¸¡è¡”æ¥åŠ¨ç”»ï¼Œæ˜¯è¿›å…¥è¡Œä¸ºé€»è¾‘çš„å…¥å£ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class EntryAnim : public IEntry
{
    CName m_animName;           // å…¥åœºè¿‡æ¸¡åŠ¨ç”»åç§°
    CName m_idleAnim;           // å…¥åœºå®Œæˆåé»˜è®¤çš„å¾…æœºå§¿åŠ¿
    Bool m_isSynchronized;      // æ˜¯å¦éœ€è¦å¤šè§’è‰²åŒæ­¥å…¥åœº
    Float m_snapToTerrainBlendTime;  // è§’è‰²å¸é™„åˆ°åœ°é¢çš„è¿‡æ¸¡æ—¶é—´
};
```
- **æ ‡å‡†åŒ–å‘½åè§„èŒƒ**
```
{èµ·å§‹å§¿åŠ¿}__to__{ç›®æ ‡å§¿åŠ¿}__turn{è§’åº¦}_{å˜ä½“ç¼–å·}
```
- **å®é™…ç¤ºä¾‹**
```
walk_0__to_sit_barstool_bar_lean0__2h_on_bar_01__turn315_01
â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”˜
  èµ·å§‹    ç›®æ ‡å®Œæ•´å§¿åŠ¿                        æ—‹è½¬è§’åº¦  å˜ä½“
```
> è¯­ä¹‰è§£æï¼šä»æ­£å‰æ–¹èµ°æ¥ â†’ ååˆ°å§å°æ¤…ã€èº«ä½“æ­£å¯¹å‰æ–¹ã€åŒæ‰‹æ­å§å° â†’ æ—‹è½¬315Â° â†’ å˜ä½“1
- **ä½¿ç”¨åœºæ™¯**
  âœ… è¡Œèµ°å…¥åœºï¼š`walk_0__to_sit_chair` èµ°æ¥ååä¸‹
  âœ… ç«™å§¿å…¥åœºï¼š`stand_2h_front__to_sit_barstool` ç«™å®šååä¸‹
  âœ… å¸¦æ—‹è½¬å…¥åœºï¼š`walk_0__to_stand__turn90_01` èµ°æ¥åæ—‹è½¬90Â°ç«™å®š
- **è¿è¡Œæ—¶æ™ºèƒ½é€‰æ‹©é€»è¾‘**
```cpp
CName SelectBestEntryAnim(Vector3 actorPos, Quaternion actorRot, Vector3 workspotPos)
{
    Float angleToWorkspot = CalculateAngle(actorPos, workspotPos, actorRot); // è®¡ç®—è§’è‰²ç›¸å¯¹ç›®æ ‡ç‚¹è§’åº¦
    Int32 turnAngle = RoundToNearest45(angleToWorkspot); // é‡åŒ–ä¸º45Â°å€æ•°ï¼ˆ8æ–¹å‘ï¼‰
    CName entryAnimName = String::Printf("walk_0__to_sit_barstool__turn%d_01", turnAngle);
    return FindEntryAnim(entryAnimName);
}
```

---

### 9. ExitAnimï¼ˆé€€å‡ºåŠ¨ç”»ï¼‰
- **å›¾æ ‡**ï¼šğŸŸ¢ ç»¿è‰²æ˜Ÿæ˜Ÿï¼ˆé€€å‡ºç®­å¤´æ ·å¼ï¼‰
- **æ ¸å¿ƒç”¨é€”**ï¼šè§’è‰²**ä»å½“å‰ Workspot â†’ é€€å‡ºåˆ°å¤–éƒ¨ä»»æ„çŠ¶æ€** çš„è¿‡æ¸¡è¡”æ¥åŠ¨ç”»ï¼Œæ˜¯é€€å‡ºè¡Œä¸ºé€»è¾‘çš„å‡ºå£ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class ExitAnim : public IEntry
{
    CName m_animName;       // é€€å‡ºè¿‡æ¸¡åŠ¨ç”»åç§°
    CName m_idleAnim;       // é€€å‡ºå®Œæˆåé»˜è®¤çš„å¾…æœºå§¿åŠ¿
    Bool m_isSynchronized;  // æ˜¯å¦éœ€è¦å¤šè§’è‰²åŒæ­¥é€€å‡º
};
```
- **æ ‡å‡†åŒ–å‘½åè§„èŒƒ**
```
{èµ·å§‹å§¿åŠ¿}__to__{ç›®æ ‡å§¿åŠ¿}__turn{è§’åº¦}_{å˜ä½“ç¼–å·}
```
- **å®é™…ç¤ºä¾‹**
```
sit_barstool_bar_lean0__2h_on_bar_01__to_stand_2h_on_sides_01__turn90_01
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
  èµ·å§‹å§¿åŠ¿(å§å°åå§¿)                      ç›®æ ‡å§¿åŠ¿(ç«™ç«‹æˆ’å¤‡)        æ—‹è½¬è§’åº¦
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… åŸºç¡€é€€å‡ºï¼š`sit_chair__to_stand` ä»åå§¿ç«™èµ·
  âœ… å¸¦æ—‹è½¬é€€å‡ºï¼š`sit__to_stand__turn180_01` ç«™èµ·åè½¬èº«180Â°ç¦»å¼€
  âœ… é€€å‡ºå³è¡Œèµ°ï¼š`sit__to_walk_0` ç«™èµ·åç›´æ¥å‘å‰èµ°

---

### 10. FastExitï¼ˆå¿«é€Ÿé€€å‡ºï¼‰
- **å›¾æ ‡**ï¼šğŸ”´ çº¢è‰²é’»çŸ³
- **æ ¸å¿ƒç”¨é€”**ï¼š**ç´§æ€¥åœºæ™¯ä¸‹çš„å¿«é€Ÿé€€å‡ºåŠ¨ç”»**ï¼Œæè‡´ç®€åŒ–è¿‡æ¸¡æµç¨‹ï¼Œä¼˜å…ˆçº§æœ€é«˜ã€‚
- **ä¸ ExitAnim çš„æ ¸å¿ƒåŒºåˆ«**
  â¡ ExitAnimï¼š**æ­£å¸¸é€€å‡º**ï¼Œå®Œæ•´è¿‡æ¸¡åŠ¨ç”»ï¼Œæ—¶é•¿1~2ç§’ï¼Œä½“éªŒæµç•…
  â¡ FastExitï¼š**ç´§æ€¥é€€å‡º**ï¼Œæç®€è¿‡æ¸¡é€»è¾‘ï¼Œæ—¶é•¿0.2~0.5ç§’ï¼Œå“åº”æå¿«
- **ä½¿ç”¨åœºæ™¯**
  âœ… æˆ˜æ–—è§¦å‘ï¼šåç€è¢«æ”»å‡»æ—¶å¿«é€Ÿè·³èµ·æˆ’å¤‡ã€è¢«å·è¢­æ—¶ç¬é—´èµ·èº«åå‡»
  âœ… ææ…Œååº”ï¼šå¬åˆ°æªå£°/çˆ†ç‚¸å£°ã€å‘ç°å±é™©ç›®æ ‡æ—¶å¿«é€Ÿç¦»å¼€å½“å‰ä½ç½®
  âœ… AIé€»è¾‘ä¸­æ–­ï¼šNPC å½“å‰è¡Œä¸ºè¢«å¼ºåˆ¶ç»ˆæ­¢ã€ä»»åŠ¡ç´§æ€¥åˆ‡æ¢
- **å®é™…ç¤ºä¾‹**
```
Fast exit: sit_barstool__2h_up_01__to_stand_2h_up_01
```
> è¯­ä¹‰è§£æï¼šä»å§å°åå§¿ï¼ˆåŒæ‰‹ä¸¾èµ·ï¼‰â†’ å¿«é€Ÿè·³èµ·åˆ°ç«™ç«‹æˆ’å¤‡å§¿åŠ¿ï¼ˆåŒæ‰‹ä¸¾èµ·ï¼‰
- **è§¦å‘é€»è¾‘å‚è€ƒ**
```cpp
void WorkspotInstance::OnThreatDetected()
{
    if (m_currentState == WorkspotState::Sitting)
    {
        PlayFastExit(); // è§¦å‘ç´§æ€¥é€€å‡ºåŠ¨ç”»
        m_animComponent->SetBlendTime(0.2f); // è®¾ç½®æçŸ­çš„æ··åˆæ—¶é—´ï¼Œæ— è¿‡æ¸¡ç¡¬åˆ‡
    }
}
```

---

### 11. LookAtDrivenTurnï¼ˆè§†çº¿é©±åŠ¨è½¬èº«ï¼‰
- **å›¾æ ‡**ï¼šğŸ”º çº¢è‰²ä¸‰è§’å½¢
- **æ ¸å¿ƒç”¨é€”**ï¼šæ ¹æ®è§’è‰²**æ³¨è§†ç›®æ ‡çš„ä½ç½®**ï¼Œè‡ªåŠ¨è®¡ç®—æ—‹è½¬è§’åº¦å¹¶æ’­æ”¾å¯¹åº”çš„è½¬èº«åŠ¨ç”»ï¼Œå®ç°è‡ªç„¶çš„ç›®æ ‡æ³¨è§†æ•ˆæœã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class LookAtDrivenTurn : public IEntry
{
    CName m_animName;          // è½¬èº«åŠ¨ç”»åç§°ï¼ˆå¦‚ turn120_01ï¼‰
    Float m_angleOffset;       // è½¬èº«è§’åº¦åç§»é‡
    Float m_angleThreshold;    // è§¦å‘è½¬èº«çš„æœ€å°è§’åº¦é˜ˆå€¼
};
```
- **æ ¸å¿ƒå·¥ä½œåŸç†**
  1. å®æ—¶æ£€æµ‹è§’è‰²å½“å‰æœå‘ä¸æ³¨è§†ç›®æ ‡çš„ä¸–ç•Œåæ ‡
  2. è®¡ç®—è§’è‰²éœ€è¦æ—‹è½¬çš„ç²¾å‡†è§’åº¦
  3. ä»é¢„è®¾çš„å¤šä¸ªè½¬èº«èŠ‚ç‚¹ä¸­åŒ¹é…æœ€æ¥è¿‘çš„è§’åº¦åŠ¨ç”»
  4. æ— ç¼æ’­æ”¾è½¬èº«åŠ¨ç”»ï¼Œå®Œæˆåä¿æŒæ³¨è§†çŠ¶æ€
- **å®é™…ç¤ºä¾‹**
```
Sequence (idle: hanako_stand_2h_front_01)
â”œâ”€ Look-at driven turn: hanako_stand_2h_front_01__turn240_01  â† ç›®æ ‡åœ¨å·¦åæ–¹
â”œâ”€ Look-at driven turn: None                                  â† ç›®æ ‡åœ¨æ­£å‰æ–¹ï¼ˆæ— éœ€è½¬èº«ï¼‰
â””â”€ Look-at driven turn: hanako_stand_2h_front_01__turn120_01  â† ç›®æ ‡åœ¨å³å‰æ–¹
```
- **è§’åº¦é€‰æ‹©é€»è¾‘å‚è€ƒ**
```cpp
CName SelectLookAtTurn(Vector3 targetPos, Quaternion actorRot)
{
    Float angleToTarget = CalculateAngle(actorRot, targetPos);
    if (angleToTarget < 30.0f) return "None";
    else if (angleToTarget >=90 && angleToTarget <150) return "turn120_01";
    else if (angleToTarget >=210 && angleToTarget <270) return "turn240_01";
    return "None";
}
```

---

### 12. PauseClipï¼ˆæš‚åœèŠ‚ç‚¹ï¼‰
- **å›¾æ ‡**ï¼šğŸ”µ è“è‰²æ—¶é’Ÿ
- **æ ¸å¿ƒç”¨é€”**ï¼šåœ¨ä¸¤ä¸ªè¿ç»­çš„åŠ¨ä½œ/åºåˆ—ä¹‹é—´ï¼Œæ’å…¥**éšæœºæ—¶é•¿çš„æ— åŠ¨ä½œåœé¡¿**ï¼Œæ¨¡æ‹ŸçœŸå®äººç±»çš„è¡Œä¸ºèŠ‚å¥ï¼Œé¿å…åŠ¨ä½œè¡”æ¥è¿‡äºæœºæ¢°ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class PauseClip : public IEntry
{
    Float m_minDuration;  // æœ€çŸ­æš‚åœæ—¶é•¿ï¼ˆç§’ï¼‰
    Float m_maxDuration;  // æœ€é•¿æš‚åœæ—¶é•¿ï¼ˆç§’ï¼‰
};
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… è‡ªç„¶èŠ‚å¥è¥é€ ï¼šåŠ¨ä½œé—´éš™çš„å‘¼å¸ã€å‘å‘†ã€æ€è€ƒåœé¡¿
  âœ… éšæœºè¡Œä¸ºå˜åŒ–ï¼šæ¯æ¬¡æš‚åœçš„æ—¶é•¿ä¸åŒï¼Œè®©è§’è‰²è¡Œä¸ºæ— è§„å¾‹å¯å¾ª
  âœ… åˆ†æ®µåŠ¨ä½œæ§åˆ¶ï¼šå°†è¿è´¯çš„åŠ¨ä½œç»„æ‹†åˆ†ä¸ºç‹¬ç«‹ç‰‡æ®µï¼Œå¢åŠ å±‚æ¬¡æ„Ÿ
- **å®é™…ç¤ºä¾‹**
```
Sequence
â”œâ”€ Random list (æŠ½çƒŸ/å¼¹çƒŸç° åŠ¨ä½œç»„)
â”œâ”€ Pause (1.000000 - 2.000000)  â† éšæœºæš‚åœ1~2ç§’
â”œâ”€ Random list (çœ‹å‘¨å›´/æ‰çœ‰å¿ƒ åŠ¨ä½œç»„)
â”œâ”€ Pause (2.000000 - 5.000000)  â† éšæœºæš‚åœ2~5ç§’
â””â”€ Random list (å¹æ°”/è°ƒæ•´åå§¿ åŠ¨ä½œç»„)
```
- **æ‰§è¡Œé€»è¾‘å‚è€ƒ**
```cpp
void WorkspotInstance::ExecutePause(PauseClip* pause)
{
    Float duration = RandomRange(pause->m_minDuration, pause->m_maxDuration);
    m_pauseTimer = duration;
    m_isPaused = true;
    // æš‚åœæœŸé—´ä¿æŒå½“å‰idleåŠ¨ç”»ï¼Œè®¡æ—¶ç»“æŸåç»§ç»­æ‰§è¡Œåç»­èŠ‚ç‚¹
}
```

---

### 13. SyncAnimClipï¼ˆåŒæ­¥åŠ¨ç”»ç‰‡æ®µï¼‰
- **æ ¸å¿ƒç”¨é€”**ï¼šç”¨äº**å¤šä¸ªè§’è‰²ååŒäº’åŠ¨**çš„åŠ¨ç”»æ’­æ”¾ï¼Œç¡®ä¿å¤šè§’è‰²çš„åŠ¨ç”»å¸§çº§åˆ«åŒæ­¥ï¼Œæ— é”™ä½/å»¶è¿Ÿã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class SyncAnimClip : public AnimClip
{
    CName m_slotName;        // åŒæ­¥é…å¯¹æ’æ§½åï¼ˆå¦‚ master/partnerï¼‰
    Transform m_syncOffset;  // è§’è‰²é—´çš„ç›¸å¯¹ä½ç½®åç§»é‡
};
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… åŒäººäº’åŠ¨åŠ¨ä½œï¼šæ¡æ‰‹ã€æ‹¥æŠ±ã€å‡»æ‹³ã€äº¤è°ˆå¯¹è§†ã€åŒäººæ‹‰æ‰¯
  âœ… å¤šäººåŒæ­¥è¡Œä¸ºï¼šåˆå”±ã€é›†ä½“èˆè¹ˆã€ä»ªå¼åŠ¨ä½œã€å°é˜Ÿé›†ç»“
  âœ… ç²¾å‡†ååŒåŠ¨ä½œï¼šåŒäººæŠ¬ç‰©ã€é…åˆæ”»å‡»ã€æ•‘æ´æ€æ‰¶
- **é…å¯¹ç¤ºä¾‹**
  - ä¸»è§’è‰²èŠ‚ç‚¹ï¼š`SyncAnimClip { animName: "handshake_master", slotName: "partner" }`
  - ä»è§’è‰²èŠ‚ç‚¹ï¼š`SyncAnimClip { animName: "handshake_slave", slotName: "master" }`

---

### 14. SyncMasterEntryAnimï¼ˆåŒæ­¥ä¸»å…¥åœºåŠ¨ç”»ï¼‰
- **æ ¸å¿ƒç”¨é€”**ï¼šå¤šäººåŒæ­¥åœºæ™¯ä¸­ï¼Œä½œä¸º**ä¸»å¯¼è§’è‰²**çš„å…¥åœºåŠ¨ç”»æ§åˆ¶å™¨ã€‚
- **æ ¸å¿ƒç‰¹ç‚¹**
  âœ… ç­‰å¾…æ‰€æœ‰é…å¯¹çš„ä»è§’è‰²åˆ°è¾¾æŒ‡å®šä½ç½®å¹¶å‡†å¤‡å°±ç»ªåï¼Œæ‰å¼€å§‹æ’­æ”¾
  âœ… ä»è§’è‰²å…¥åœºå¤±è´¥/è¶…æ—¶ï¼Œä¸»è§’è‰²çš„å…¥åœºåŠ¨ä½œä¼šåŒæ­¥ä¸­æ–­
  âœ… ç»Ÿä¸€ç®¡æ§å¤šè§’è‰²çš„å…¥åœºèŠ‚å¥ï¼Œæ— å…ˆåé”™ä½

---

### 15. AnimClipWithItemï¼ˆå¸¦é“å…·çš„åŠ¨ç”»ï¼‰
- **æ ¸å¿ƒç”¨é€”**ï¼šæ’­æ”¾åŠ¨ç”»çš„åŒæ—¶ï¼Œè‡ªåŠ¨ç»‘å®š/ä½¿ç”¨**æŒ‡å®šçš„æ¸¸æˆé“å…·**ï¼ŒåŠ¨ç”»ä¸é“å…·çš„åŠ¨ä½œç²¾å‡†åŒ¹é…ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class AnimClipWithItem : public AnimClip
{
    CName m_itemName;        // é“å…·èµ„æºåç§°ï¼ˆé¦™çƒŸ/æ¯å­/æ‰‹æªï¼‰
    CName m_slotName;        // é“å…·é™„ç€çš„éª¨éª¼æ’æ§½ï¼ˆæ‰‹éƒ¨/å˜´è¾¹ï¼‰
    Bool m_hideWhenFinished; // åŠ¨ç”»ç»“æŸåæ˜¯å¦è‡ªåŠ¨éšè—é“å…·
};
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… é“å…·æ‹¾å–ä¸ä½¿ç”¨ï¼šæ‹¿èµ·æ¯å­å–æ°´ã€æ‹¿èµ·é¦™çƒŸç‚¹ç‡ƒã€æ‹¿èµ·æ‰‹æªç„å‡†
  âœ… é“å…·äº¤äº’åŠ¨ä½œï¼šç”¨æ‰“ç«æœºç‚¹ç«ã€ç”¨æ‰‹æœºæ‰“ç”µè¯ã€ç”¨é…’ç“¶æ•²å‡»æ¡Œé¢
  âœ… é“å…·æ”¶èµ·åŠ¨ä½œï¼šå–å®Œæ°´æ”¾ä¸‹æ¯å­ã€æŠ½å®ŒçƒŸæ‰”æ‰çƒŸè’‚ã€ç”¨å®Œæªæ”¶è¿›è…°é—´

---

### 16. TagNodeï¼ˆæ ‡ç­¾èŠ‚ç‚¹ï¼‰
- **å›¾æ ‡**ï¼šğŸ·ï¸ æ ‡ç­¾ç¬¦å·
- **æ ¸å¿ƒç”¨é€”**ï¼šåœ¨è¡Œä¸ºæ ‘çš„æŒ‡å®šæ‰§è¡ŒèŠ‚ç‚¹ï¼Œæ’å…¥**æ ‡è®°ä¿¡å·**ï¼Œç”¨äºè§¦å‘æ¸¸æˆå†…å…¶ä»–ç³»ç»Ÿçš„äº‹ä»¶ï¼Œæ— è§†è§‰è¡¨ç°ã€‚
- **æ ¸å¿ƒå±æ€§**
```cpp
class TagNode : public IEntry
{
    CName m_tagName;  // è‡ªå®šä¹‰æ ‡ç­¾åç§°
};
```
- **ä½¿ç”¨åœºæ™¯**
  âœ… æ¸¸æˆäº‹ä»¶è§¦å‘ï¼šæ ‡è®°å¯¹è¯å¼€å§‹/ç»“æŸç‚¹ã€å‰§æƒ…è§¦å‘èŠ‚ç‚¹ã€ä»»åŠ¡è¿›åº¦æ›´æ–°ç‚¹
  âœ… å¤šç³»ç»ŸåŒæ­¥ï¼šç»™éŸ³æ•ˆ/ç‰¹æ•ˆ/UIç³»ç»Ÿå‘é€åŒæ­¥ä¿¡å·ï¼Œå®ç°è§†å¬è”åŠ¨
  âœ… å¼€å‘è°ƒè¯•æ ‡è®°ï¼šåŸ‹ç‚¹è®°å½•è¡Œä¸ºæ‰§è¡ŒèŠ‚ç‚¹ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥ä¸æ€§èƒ½åˆ†æ

---

## âœ… èŠ‚ç‚¹é€‰æ‹©é€ŸæŸ¥æŒ‡å—ï¼ˆæ ¸å¿ƒæ€»ç»“ï¼‰
| ä¸šåŠ¡éœ€æ±‚ | æ¨èä½¿ç”¨èŠ‚ç‚¹ | å…¸å‹åº”ç”¨åœºæ™¯ |
| :--- | :--- | :--- |
| æŒ‰æ­¥éª¤ä¾æ¬¡æ‰§è¡Œå¤šä¸ªåŠ¨ä½œ | Sequence | èµ°æ¥ â†’ åä¸‹ â†’ å–æ°´ â†’ æ”¾ä¸‹æ¯å­ â†’ ç«™èµ· |
| ä»å¤šä¸ªåŠ¨ä½œä¸­éšæœºæ’­æ”¾å˜ä½“ | RandomList | éšæœºè§¦å‘æŒ å¤´/æ‰çœ¼ç›/å¹æ°”/æŠ½çƒŸç­‰å°åŠ¨ä½œ |
| å“åº”ç‰©ç†ç¢°æ’/æƒ…ç»ªè§¦å‘äº‹ä»¶ | ReactionSequence | è¢«æ’åçš„è¸‰è·„ã€è¢«å“åˆ°çš„åä»°ã€è¢«æ”»å‡»çš„é—ªé¿ |
| æœ‰å‰ç½®æ¡ä»¶çš„è¡Œä¸ºé€»è¾‘ | ConditionalSequence | æ—©æ™¨å–å’–å•¡ã€é›¨å¤©æ’‘ä¼ã€å¥½æ„Ÿè¾¾æ ‡åçš„ä¸“å±äº’åŠ¨ |
| æ’­æ”¾æ— ä½ç§»çš„åŸºç¡€åŠ¨ç”» | AnimClip | ç«™ç«‹å¾…æœºã€åç€å‘å‘†ã€ç‚¹å¤´å›åº” |
| æ’­æ”¾å¸¦ä½ç§»çš„åŠ¨ç”» | MotionAnimClip | å¯¹è¯å‘å‰å‡‘ã€ä¾§æ­¥è°ƒæ•´ç«™ä½ã€åŸåœ°è¸±æ­¥ |
| ä»å¤–éƒ¨è¿›å…¥å½“å‰è¡Œä¸ºé€»è¾‘ | EntryAnim | èµ°æ¥åååˆ°æ¤…å­ä¸Šã€è·‘è¿‡æ¥ç«™å®šè­¦æˆ’ |
| ä»å½“å‰è¡Œä¸ºæ­£å¸¸é€€å‡º | ExitAnim | ä»åå§¿ç«™èµ·ã€ä»ç«™å§¿èµ°å¼€ã€ç»“æŸäº’åŠ¨ç¦»å¼€ |
| ç´§æ€¥æƒ…å†µå¿«é€Ÿé€€å‡º | FastExit | é‡è¢­æ—¶ç¬é—´èµ·èº«ã€å‘ç°å±é™©æ—¶ç«‹åˆ»æ’¤ç¦» |
| è‡ªåŠ¨è½¬èº«é¢å‘æ³¨è§†ç›®æ ‡ | LookAtDrivenTurn | è½¬èº«é¢å‘è¯´è¯çš„ç©å®¶ã€çœ‹å‘è·¯è¿‡çš„NPCã€æ³¨è§†ç›®æ ‡ç‚¹ |
| åŠ¨ä½œé—´éš™æ·»åŠ åœé¡¿èŠ‚å¥ | PauseClip | æŠ½çƒŸååœé¡¿1~2ç§’ã€å–æ°´ååœé¡¿2~3ç§’å†åšä¸‹ä¸€ä¸ªåŠ¨ä½œ |
| å¤šè§’è‰²ååŒäº’åŠ¨åŠ¨ç”» | SyncAnimClip | ä¸ç©å®¶æ¡æ‰‹ã€åŒäººæ‹¥æŠ±ã€å°é˜Ÿé›†ä½“æ•¬ç¤¼ |
| åŠ¨ç”»ä¸­ä½¿ç”¨é“å…· | AnimClipWithItem | æ‹¿æ¯å­å–æ°´ã€æ‹¿çƒŸæŠ½çƒŸã€æ‹¿æªç„å‡† |
| è§¦å‘æ¸¸æˆäº‹ä»¶/åŸ‹ç‚¹ | TagNode | æ ‡è®°å¯¹è¯å¼€å§‹ã€è§¦å‘ç‰¹æ•ˆæ’­æ”¾ã€è®°å½•è¡Œä¸ºæ‰§è¡ŒèŠ‚ç‚¹ |

> âœ¨ æ ¸å¿ƒä»·å€¼ï¼šè¿™å¥—å®Œæ•´çš„ IEntry èŠ‚ç‚¹ä½“ç³»ï¼Œè®© Workspot å¯ä»¥çµæ´»ç»„åˆå‡ºä»ã€Œç®€å•çš„åç€å‘å‘†ã€åˆ°ã€Œå¤šè§’è‰²åŒæ­¥äº’åŠ¨+ç‰©ç†ç¢°æ’ååº”+æ¡ä»¶åˆ†æ”¯é€»è¾‘ã€çš„å…¨ç»´åº¦è§’è‰²è¡Œä¸ºï¼Œæ˜¯ã€Šèµ›åšæœ‹å…‹2077ã€‹è§’è‰²è¡Œä¸ºè¡¨ç°åŠ›çš„æ ¸å¿ƒæ”¯æ’‘ï¼






