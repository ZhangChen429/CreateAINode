# ã€Šèµ›åšæœ‹å…‹2077ã€‹AIè¡Œä¸ºç³»ç»Ÿæ·±åº¦åˆ†æ

> åŸºäºæºä»£ç çš„å®Œæ•´æŠ€æœ¯åˆ†ææŠ¥å‘Š
> åˆ†ææ—¥æœŸï¼š2025-10-22
> æºä»£ç è·¯å¾„ï¼šE:\SoftApp\Sy2077\2077\2077\CDPR2077\dev\src

---

## ç›®å½•

- [ä¸€ã€æ ¸å¿ƒæ¶æ„æ¦‚è§ˆ](#ä¸€æ ¸å¿ƒæ¶æ„æ¦‚è§ˆ)
- [äºŒã€è¡Œä¸ºæ ‘ç³»ç»Ÿ](#äºŒè¡Œä¸ºæ ‘ç³»ç»Ÿ-behavior-tree-system)
- [ä¸‰ã€å‘½ä»¤ç³»ç»Ÿ](#ä¸‰å‘½ä»¤ç³»ç»Ÿ-command-system)
- [å››ã€ç¯å¢ƒæ¥å£](#å››ç¯å¢ƒæ¥å£-environment-interface)
- [äº”ã€TweakDB AIé…ç½®ç³»ç»Ÿ](#äº”tweakdb-aié…ç½®ç³»ç»Ÿ)
- [å…­ã€å®é™…åº”ç”¨æ¡ˆä¾‹åˆ†æ](#å…­å®é™…åº”ç”¨æ¡ˆä¾‹åˆ†æ)
- [ä¸ƒã€æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯æ€»ç»“](#ä¸ƒæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯æ€»ç»“)
- [å…«ã€è°ƒè¯•å’Œå¼€å‘å·¥å…·](#å…«è°ƒè¯•å’Œå¼€å‘å·¥å…·)
- [ä¹ã€çº¿ç¨‹å®‰å…¨å’Œå¹¶å‘](#ä¹çº¿ç¨‹å®‰å…¨å’Œå¹¶å‘)
- [åã€æ€»ç»“ï¼šAIè¡Œä¸ºç³»ç»Ÿçš„è®¾è®¡å“²å­¦](#åæ€»ç»“aiè¡Œä¸ºç³»ç»Ÿçš„è®¾è®¡å“²å­¦)
- [åä¸€ã€ä¸UseWorkspotNodeçš„å®Œæ•´å…³è”](#åä¸€ä¸useworkspotnodeçš„å®Œæ•´å…³è”)

---

## ä¸€ã€æ ¸å¿ƒæ¶æ„æ¦‚è§ˆ

### 1.1 ç³»ç»Ÿåˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TweakDB é…ç½®å±‚ (Data-Driven)                 â”‚
â”‚  - AIAction Records                                 â”‚
â”‚  - AICondition Records                              â”‚
â”‚  - AITarget Records                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      è¡Œä¸ºæ ‘å±‚ (Behavior Tree Layer)                  â”‚
â”‚  - Tree Nodes (å†³ç­–ã€æ¡ä»¶ã€åŠ¨ä½œ)                     â”‚
â”‚  - Behavior Instance (å®ä¾‹ç®¡ç†)                     â”‚
â”‚  - Execution Context (æ‰§è¡Œä¸Šä¸‹æ–‡)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å‘½ä»¤é˜Ÿåˆ—å±‚ (Command Queue Layer)                â”‚
â”‚  - Command System (å‘½ä»¤ç³»ç»Ÿ)                        â”‚
â”‚  - Context Management (ä¸Šä¸‹æ–‡ç®¡ç†)                  â”‚
â”‚  - Priority Handling (ä¼˜å…ˆçº§å¤„ç†)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åŠ¨ä½œæ‰§è¡Œå±‚ (Action Execution Layer)             â”‚
â”‚  - Movement Actions (ç§»åŠ¨)                          â”‚
â”‚  - Drive Actions (é©¾é©¶)                             â”‚
â”‚  - Combat Actions (æˆ˜æ–—)                            â”‚
â”‚  - Animation Actions (åŠ¨ç”»)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒç›®å½•ç»“æ„

```
E:\SoftApp\Sy2077\2077\2077\CDPR2077\dev\src\
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ ai/                    # åŸºç¡€AIè¡Œä¸ºæ¡†æ¶ (134ä¸ªå¤´æ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ include/           # å…¬å…±æ¥å£
â”‚   â”‚   â””â”€â”€ src/               # å®ç°æ–‡ä»¶ (~100+ .cppæ–‡ä»¶)
â”‚   â”œâ”€â”€ gameAI/                # æ¸¸æˆç‰¹å®šAIå®ç° (181ä¸ªå¤´æ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ include/           # æ¸¸æˆAIæ¥å£
â”‚   â”‚   â””â”€â”€ src/               # å®ç°æ–‡ä»¶ (142ä¸ªå¤´æ–‡ä»¶)
â”‚   â”œâ”€â”€ gameTweakDB/           # TweakDBé…ç½®ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ include/
â”‚   â”‚       â”œâ”€â”€ records/       # AIç›¸å…³Recordç±»å‹å®šä¹‰
â”‚   â”‚       â””â”€â”€ types/         # AIç›¸å…³Typeå®šä¹‰
â”‚   â””â”€â”€ engine/                # å¼•æ“æ ¸å¿ƒ(åŒ…å«BehaviorGraph)
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ backendAI/             # AIç¼–è¾‘å™¨åç«¯
â”‚   â”œâ”€â”€ backendBehavior/       # è¡Œä¸ºç¼–è¾‘å™¨åç«¯
â”‚   â””â”€â”€ backendGame/           # æ¸¸æˆç¼–è¾‘å™¨åç«¯
â””â”€â”€ editor/
    â””â”€â”€ editorBehavior/        # è¡Œä¸ºç¼–è¾‘å™¨å‰ç«¯
```

---

## äºŒã€è¡Œä¸ºæ ‘ç³»ç»Ÿ (Behavior Tree System)

### 2.1 è¡Œä¸ºæ ‘èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiTreeNode.h:26-45`

```cpp
enum class EExecutionStatus
{
    STATUS_INVALID,    // æœªåˆå§‹åŒ–çŠ¶æ€
    STATUS_SUCCESS,    // æˆåŠŸå®Œæˆ
    STATUS_FAILURE,    // æ‰§è¡Œå¤±è´¥
    STATUS_RUNNING,    // æ­£åœ¨æ‰§è¡Œä¸­
    STATUS_ABORTED,    // è¢«ä¸­æ­¢
};

// èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸå››é˜¶æ®µï¼š
virtual EExecutionOutcome OnActivate(ActivationContext& context) const;
virtual EExecutionOutcome OnUpdate(UpdateContext& context) const;
virtual void OnDeactivate(DeactivationContext& context) const;
virtual EInterruptionOutcome OnInterrupt(InterruptionContext& context) const;
```

**æ‰§è¡Œæµç¨‹å›¾**ï¼š
```
    [Inactive]
        â”‚
        â–¼ OnActivate()
   [Activated] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â”‚ OnUpdate()            â”‚ OnInterrupt()
        â–¼                       â”‚
   [Running] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[Interrupted]
        â”‚                       â”‚
        â”‚ STATUS_SUCCESS/       â”‚
        â”‚ STATUS_FAILURE        â”‚
        â–¼                       â”‚
   [Completed] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ OnDeactivate()
   [Deactivated]
```

### 2.2 è¡Œä¸ºå®ä¾‹ç®¡ç†

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiBehaviorInstance.h:42-190`

```cpp
class Instance : public red::NonCopyable
{
    // æ ¸å¿ƒç”Ÿå‘½å‘¨æœŸ
    void Activate(IEnvironment& environment, CAgent& agent);
    void Update(IEnvironment& environment, CAgent& agent, Float timeDelta);
    void Deactivate(IEnvironment& environment, CAgent& agent);
    Bool IsActive() const { return m_isActive; }

    // äº‹ä»¶å¤„ç†
    void OnEvent(IEnvironment& environment, CAgent& agent, const AIEvent& event);

    // æ›´æ–°é˜Ÿåˆ—ç®¡ç†ï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰
    Bool AddToUpdateQueue(const Updatable& node);
    Bool RemoveFromUpdateQueue(const Updatable& node);
    Bool AddToUpdateOnceQueue(const Updatable* node);
    Bool RemoveFromUpdateOnceQueue(const Updatable* node);

private:
    InstanceBufferIntrusive m_buffer;          // å®ä¾‹æ•°æ®ç¼“å†²åŒº
    Bool m_isActive = false;                   // æ¿€æ´»çŠ¶æ€
    UpdateId m_behaviorUpdateId;               // æ›´æ–°IDï¼ˆæ¯æ¬¡Updateé€’å¢ï¼‰

    // æ›´æ–°é˜Ÿåˆ—ï¼ˆæ€§èƒ½ä¼˜åŒ–å…³é”®ï¼‰
    red::DynArray<UpdateQueueItem> m_updateQueue;

    // äº‹ä»¶å¤„ç†å™¨
    red::DynArray<const EventHandler*> m_eventHandlers;

    // å¼‚æ­¥å›è°ƒæ”¯æŒ
    red::HashMap<AsyncCallback::Id, const AsyncCallback*> m_callbacks;
};
```

**æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼š
- âœ… **é€‰æ‹©æ€§æ›´æ–°**ï¼šåªæœ‰åŠ å…¥ `m_updateQueue` çš„èŠ‚ç‚¹æ‰ä¼šè¢«Update
- âœ… **Update Onceé˜Ÿåˆ—**ï¼šä¸€æ¬¡æ€§æ›´æ–°èŠ‚ç‚¹ä¸ä¼šæŒç»­å ç”¨CPU
- âœ… **å®ä¾‹æ•°æ®ç¼“å†²åŒº**ï¼š`InstanceBufferIntrusive` å°†è¿è¡Œæ—¶æ•°æ®ç´§å¯†æ‰“åŒ…ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡

### 2.3 ä¸»è¦èŠ‚ç‚¹ç±»å‹

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameAI/include/`

| èŠ‚ç‚¹ç±»å‹ | æ–‡ä»¶ | è¯´æ˜ |
|---------|------|------|
| **Action** | aiTreeNodeAction.h | æ‰§è¡Œå…·ä½“æ¸¸æˆåŠ¨ä½œçš„èŠ‚ç‚¹ |
| **Composite** | aiTreeNodeComposite.h | å®¹çº³å¤šä¸ªå­èŠ‚ç‚¹çš„å®¹å™¨ |
| **Atomic** | aiTreeNodeAtomic.h | åŸå­æ“ä½œèŠ‚ç‚¹ |
| **Brain** | aiTreeNodeBrain.h | NPCå¤§è„‘æ§åˆ¶èŠ‚ç‚¹ |
| **Condition** | aiTreeNodeCondition.h | æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹ |
| **Decision** | aiTreeNodeDecision.h | å†³ç­–é€‰æ‹©èŠ‚ç‚¹ |
| **FSM** | aiTreeNodeFSM.h | æœ‰é™çŠ¶æ€æœºèŠ‚ç‚¹ |
| **InterruptionDecorator** | aiTreeNodeInterruptionDecorator.h | ä¸­æ–­å¤„ç†è£…é¥°å™¨ |
| **ExtendableNode** | aiTreeExtendableNode.h | å¯æ‰©å±•èŠ‚ç‚¹åŸºç±» |

---

## ä¸‰ã€å‘½ä»¤ç³»ç»Ÿ (Command System)

### 3.1 å‘½ä»¤çŠ¶æ€æœº

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiCommand.h:18-33`

```cpp
enum class CommandState
{
    NotExecuting,   // å°šæœªæ‰§è¡Œ
    Enqueued,       // å·²å…¥é˜Ÿç­‰å¾…
    Executing,      // æ­£åœ¨æ‰§è¡Œ
    Cancelled,      // è¢«å–æ¶ˆ
    Interrupted,    // è¢«ä¸­æ–­
    Success,        // æ‰§è¡ŒæˆåŠŸ
    Failure         // æ‰§è¡Œå¤±è´¥
};
```

**çŠ¶æ€è½¬æ¢å›¾**ï¼š
```
[NotExecuting]
      â”‚
      â–¼ Enqueue()
 [Enqueued] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                    â”‚ Cancel()
      â–¼ StartExecuting()   â”‚
 [Executing] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
      â”‚                    â”‚      â”‚ Interrupt()
      â”‚                    â–¼      â–¼
      â”‚              [Cancelled] [Interrupted]
      â”‚
      â”œâ”€â”€â”€â”€â”€â”€â–º [Success]
      â””â”€â”€â”€â”€â”€â”€â–º [Failure]
```

### 3.2 å‘½ä»¤çŠ¶æ€å˜åŒ–ä¸Šä¸‹æ–‡

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiCommand.h:70-95`

```cpp
struct CommandStateChangeContext
{
    CommandState m_oldState;    // å˜åŒ–å‰çš„çŠ¶æ€
    CommandState m_newState;    // å˜åŒ–åçš„çŠ¶æ€

    // çŠ¶æ€å˜åŒ–çš„åŸå› å’Œæ„å›¾æ ‡å¿—
    CommandStateChangeFlags m_flags;
    /*
    å¯ç”¨æ ‡å¿—ï¼š
    - DoNotRepeat          // ä¸è¦é‡å¤æ‰§è¡Œ
    - QueueOverflow        // é˜Ÿåˆ—æº¢å‡º
    - InterruptedByCommand // è¢«å…¶ä»–å‘½ä»¤ä¸­æ–­
    - DespawningEntity     // å®ä½“æ­£åœ¨æ¶ˆå¤±
    - SpawningEntity       // å®ä½“æ­£åœ¨ç”Ÿæˆ
    */

    CommandPtr m_interruptingCommand;  // å¯¼è‡´ä¸­æ–­çš„å‘½ä»¤
};
```

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- ğŸ“Š **å®Œæ•´çš„è¿½æº¯ä¿¡æ¯**ï¼šçŸ¥é“å‘½ä»¤ä¸ºä»€ä¹ˆè¢«ä¸­æ–­/å–æ¶ˆ
- ğŸ”„ **æ™ºèƒ½é‡è¯•**ï¼šæ ¹æ®flagså†³å®šæ˜¯å¦é‡æ–°æ‰§è¡Œ
- ğŸ› **è°ƒè¯•å‹å¥½**ï¼šçŠ¶æ€å˜åŒ–åŸå› ä¸€ç›®äº†ç„¶

### 3.3 å‘½ä»¤é˜Ÿåˆ—ç®¡ç†

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiCommandQueue.h:149-200`

```cpp
class CommandQueue
{
    static constexpr Uint32 c_maxQueueSize = 16;  // æœ€å¤§é˜Ÿåˆ—å®¹é‡

    // å‘½ä»¤ä¸Šä¸‹æ–‡ç±»å‹
    enum CommandContexts {
        Default,     // é»˜è®¤ä¸Šä¸‹æ–‡
        Immediate,   // ç«‹å³æ‰§è¡Œä¸Šä¸‹æ–‡
        Movement,    // ç§»åŠ¨ç›¸å…³å‘½ä»¤
        Workspot,    // å·¥ä½œç‚¹ç›¸å…³
        Aiming,      // ç„å‡†ç›¸å…³
        Count
    };

    // æ ¸å¿ƒæ“ä½œ
    void Enqueue(const behavior::IEnvironment* env, CommandPtr command);

    Bool StartExecuting(const behavior::IEnvironment* env,
                       CName commandName,
                       TContextMask contextMask,
                       CommandPtr& outCommand,
                       TCallback callback = nullptr);

    Bool FinishExecuting(const behavior::IEnvironment* env,
                        CommandPtr command,
                        bool success = true);

    Bool Cancel(...);
    Bool Interrupt(...);

private:
    ent::Entity* m_entity;

    // å¤šä¸Šä¸‹æ–‡å¹¶è¡Œæ‰§è¡Œæ”¯æŒ
    CommandPtr m_contexts[CommandContexts::Count];

    // ç­‰å¾…é˜Ÿåˆ—
    StaticArray<CommandPtr, c_maxQueueSize> m_queue;

    // æš‚å­˜é˜Ÿåˆ—ï¼ˆç”¨äºä¸´æ—¶æŒ‚èµ·å‘½ä»¤ï¼‰
    StaticArray<CommandPtr, c_maxQueueSize> m_stashedCommands;

    // æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨
    DynArray<CommandPtr> m_executingCommands;
};
```

### 3.4 å¤šä¸Šä¸‹æ–‡å¹¶è¡Œæ‰§è¡Œ

**å…³é”®ç‰¹æ€§**ï¼šä¸åŒç±»å‹çš„å‘½ä»¤å¯ä»¥åŒæ—¶æ‰§è¡Œ

```cpp
// åŒæ—¶æ‰§è¡Œçš„å‘½ä»¤ç¤ºä¾‹
m_contexts[Movement]   -> MoveToCommand (ç§»åŠ¨åˆ°ä½ç½®)
m_contexts[Workspot]   -> UseWorkspotCommand (ä½¿ç”¨å·¥ä½œç‚¹)
m_contexts[Aiming]     -> AimAtCommand (ç„å‡†ç›®æ ‡)
```

**å®é™…æ¸¸æˆåœºæ™¯**ï¼š
- NPC åœ¨ç§»åŠ¨çš„åŒæ—¶å¯ä»¥ç„å‡†ç©å®¶
- ååœ¨æ¤…å­ä¸Šçš„ NPC å¯ä»¥åŒæ—¶æ‰§è¡Œå¯¹è¯å‘½ä»¤

### 3.5 ä¸Šä¸‹æ–‡æ©ç  (Context Mask)

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiCommandQueue.h:56-58`

```cpp
constexpr Uint8 CreateContextMask(CommandContexts::Type s) {
    return 1 << s;  // ä½æ©ç 
}

// ä½¿ç”¨ç¤ºä¾‹
TContextMask movementAndAiming =
    CreateContextMask(CommandContexts::Movement) |
    CreateContextMask(CommandContexts::Aiming);

// æ£€æŸ¥è¿™äº›ä¸Šä¸‹æ–‡æ˜¯å¦ç©ºé—²
if (IsContextFree(movementAndAiming)) {
    // å¯ä»¥æ‰§è¡Œéœ€è¦ç§»åŠ¨å’Œç„å‡†çš„å‘½ä»¤
}
```

### 3.6 æš‚å­˜æœºåˆ¶ (Stashing)

```cpp
Bool Stash(const behavior::IEnvironment* env, const CommandPtr& command);
void UnstashAll(const behavior::IEnvironment* env);
```

**åº”ç”¨åœºæ™¯**ï¼š
```
NPCæ­£åœ¨æ‰§è¡Œ: å·¡é€»å‘½ä»¤
ç©å®¶æ¥è¿‘ -> è§¦å‘ååº”
  â†“
1. Stash(å·¡é€»å‘½ä»¤)      // æš‚å­˜å½“å‰å‘½ä»¤
2. Enqueue(ååº”å‘½ä»¤)     // æ‰§è¡Œæ–°å‘½ä»¤
3. ååº”å®Œæˆ
4. UnstashAll()         // æ¢å¤å·¡é€»
```

### 3.7 å›è°ƒç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiCommandQueue.h:156-159`

```cpp
using TCallbackId = Uint32;
using TCallback = red::FixedSizeFunction<
    Bool(TCallbackId, CommandPtr, const CommandStateChangeContext& ctx),
    48  // 48å­—èŠ‚æ ˆç¼“å†²
>;

TCallbackId AddCallback(TCallbackStorage callback);
TCallbackId AddCallback(CommandPtr command, TCallback callback);
Bool RemoveCallback(TCallbackId callbackId);
```

**å›è°ƒä½¿ç”¨ç¤ºä¾‹**ï¼š
```cpp
// UseWorkspotNodeä¸­çš„å›è°ƒä½¿ç”¨
CommandQueue::TCallback callback = [](
    TCallbackId id,
    CommandPtr command,
    const CommandStateChangeContext& ctx
) -> Bool {
    if (ctx.m_newState == CommandState::Success) {
        // å·¥ä½œç‚¹å‘½ä»¤æˆåŠŸå®Œæˆ
        TriggerWorkspotFinishedEvent();
        return false;  // false = ç§»é™¤æ­¤å›è°ƒ
    }
    return true;  // true = ä¿ç•™å›è°ƒç»§ç»­ç›‘å¬
};

commandQueue.AddCallback(workspotCommand, callback);
```

---

## å››ã€ç¯å¢ƒæ¥å£ (Environment Interface)

### 4.1 IEnvironment - AIä¸æ¸¸æˆä¸–ç•Œçš„æ¡¥æ¢

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiEnvironment.h:52-123`

```cpp
class IEnvironment
{
public:
    // å®ä½“å’Œæ‰€æœ‰è€…è®¿é—®
    virtual CAgent* GetAI() const = 0;
    virtual ent::Entity& GetAIEntity() const = 0;
    virtual game::Object& GetOwner() const = 0;

    // é…ç½®æ•°æ®è®¿é—®
    virtual Bool GetRecordID(game::data::RecordID& recordId) const = 0;

    // è¡Œä¸ºå®ä¾‹ç®¡ç†
    virtual void OnBehaviorInstanceActivated(Instance* instance) = 0;
    virtual Bool OnBehaviorInstanceDeactivated(Instance* instance) = 0;
    virtual Instance* GetBehaviorInstance(InstanceId id) const = 0;

    // å‘½ä»¤é˜Ÿåˆ—è®¿é—®
    virtual CommandQueue& GetCommandQueue() const = 0;
    virtual Bool GetCommand(CName commandName, CommandPtr& outCommand, ...) = 0;
    virtual Bool IsCommandEnqueued(CName commandName, ...) const = 0;
    virtual Bool StartExecutingCommand(...) = 0;
    virtual Bool StopExecutingCommand(CommandPtr command, Bool success) = 0;

    // ä¿¡å·ç³»ç»Ÿï¼ˆç”¨äºèŠ‚ç‚¹é—´é€šä¿¡ï¼‰
    virtual Bool GetSignal(CName name) const = 0;
    virtual Bool SetSignal(CName name, Bool value = true) = 0;

    // é»‘æ¿ç³»ç»Ÿï¼ˆå…±äº«æ•°æ®ï¼‰
    virtual game::IBlackboard* GetBlackboard(CName name) const = 0;

    // LODç®¡ç†
    virtual LODType GetLOD() const = 0;

    // æŒä¹…åŒ–æ•°æ®
    virtual Bool GetPersistentValue(CName name, rtti::Variant& value) const = 0;
    virtual Bool SetPersistentValue(CName name, const rtti::Variant& value, ...) = 0;

    // AIè§’è‰²
    virtual const THandle<Role>& GetAIRole() const = 0;
    virtual void SetAIRole(const THandle<Role>& aiRole) = 0;
};
```

### 4.2 æ¡¥æ¥æ¨¡å¼ (Bridge Pattern)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Behavior     â”‚         â”‚   Game World        â”‚
â”‚  (æŠ½è±¡å±‚)        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   (å®ç°å±‚)          â”‚
â”‚                  â”‚         â”‚                     â”‚
â”‚ - Behavior Tree  â”‚  uses   â”‚ - Entity System     â”‚
â”‚ - Command Queue  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ - Blackboard        â”‚
â”‚ - Conditions     â”‚         â”‚ - Signals           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                            â–²
         â”‚                            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  IEnvironment  â”‚
           â”‚   (æ¥å£å±‚)      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- âœ… **è§£è€¦åˆ**ï¼šAIä»£ç ä¸ç›´æ¥ä¾èµ–æ¸¸æˆä»£ç 
- âœ… **å¯æµ‹è¯•**ï¼šå¯ä»¥Mock IEnvironmentè¿›è¡Œå•å…ƒæµ‹è¯•
- âœ… **æ¨¡å—åŒ–**ï¼šAIç³»ç»Ÿå¯ä»¥ç‹¬ç«‹å¼€å‘å’Œè¿­ä»£

---

## äº”ã€TweakDB AIé…ç½®ç³»ç»Ÿ

### 5.1 TweakDBåŠ¨ä½œè¯„ä¼°ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameAI/include/aiTweakActionSystem.h:32-232`

```cpp
class TweakActionSystem : public game::IGameSystem
{
public:
    // æ¡ä»¶è¯„ä¼°
    Outcome EvaluateCondition(
        ExecutionContext& ctx,
        game::data::AIActionCondition_Record& record,
        Bool& outValue
    );

    Outcome EvaluateSubcondition(
        ExecutionContext& ctx,
        game::data::AIActionSubCondition_Record& record,
        Bool& outValue
    );

    // ç›®æ ‡è¯„ä¼°
    Outcome EvaluateTarget(
        ExecutionContext& ctx,
        game::data::AIActionTarget_Record& record,
        THandle<game::Object>& outValue
    );

    // æ”¯æŒé¢„æµ‹
    Outcome EvaluateTarget(
        ExecutionContext& ctx,
        const game::data::TweakDBID& targetRecordId,
        Float predictionTime,  // é¢„æµ‹æœªæ¥Nç§’åçš„ç›®æ ‡ä½ç½®
        TargetLocation& outValue
    );

private:
    // ç¼–è¯‘åçš„Recordç¼“å­˜
    red::HashMap<game::data::TweakDBID, CompiledRecordPtr> m_compiledRecords;

    // æ¯ä¸ªå®ä½“çš„å®ä¾‹ç¼“å­˜
    struct EntityEntry {
        WeakHandle<AI::CAgent> m_owner;

        // æ¡ä»¶/ç›®æ ‡å®ä¾‹ï¼ˆå¸¦çŠ¶æ€ï¼‰
        red::HashMap<game::data::TweakDBID, InstancePtr> m_instances;

        // æ–°åˆ›å»ºçš„å®ä¾‹ï¼ˆå¾…æ¿€æ´»ï¼‰
        red::HashMap<game::data::TweakDBID, InstancePtr> m_newInstances;
    };

    red::HashMap<ent::EntityID, EntityEntryPtr> m_entities;
};
```

### 5.2 ç¼–è¯‘å’Œç¼“å­˜æœºåˆ¶

**æ€§èƒ½ä¼˜åŒ–çš„ä¸‰å±‚æ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 1: TweakDB Record (åŸå§‹é…ç½®æ•°æ®)             â”‚
â”‚  - ä»ç£ç›˜åŠ è½½çš„JSON/TWEAKæ–‡ä»¶                       â”‚
â”‚  - åŒ…å«å­—ç¬¦ä¸²ã€IDå¼•ç”¨                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Compile (é¦–æ¬¡è®¿é—®æ—¶)
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 2: Compiled Record (ç¼–è¯‘åçš„æ•°æ®)           â”‚
â”‚  - è§£ææ‰€æœ‰å¼•ç”¨                                     â”‚
â”‚  - é¢„è®¡ç®—å¸¸é‡                                       â”‚
â”‚  - å…¨å±€ç¼“å­˜ï¼šm_compiledRecords                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Instantiate (æ¯ä¸ªNPC)
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 3: Instance (å®ä¾‹åŒ–è¿è¡Œæ—¶çŠ¶æ€)               â”‚
â”‚  - åŒ…å«NPCç‰¹å®šçš„è¿è¡Œæ—¶æ•°æ®                         â”‚
â”‚  - æ”¯æŒçŠ¶æ€ç¼“å­˜                                     â”‚
â”‚  - æ¯å®ä½“ç¼“å­˜ï¼šEntityEntry::m_instances             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 å®é™…ä¾‹å­

```cpp
// TweakDB é…ç½®
Items.Weapon.DamageCondition = {
    type: "StatCondition",
    statType: "Health",
    comparisonType: "LessThan",
    value: 50.0
}

// ç¼–è¯‘åï¼ˆCompiled Recordï¼‰
class CompiledStatCondition {
    game::data::StatType m_statType = StatType::Health;  // å·²è§£æ
    ComparisonType m_comparison = ComparisonType::LessThan;  // å·²è§£æ
    Float m_value = 50.0f;  // å·²ç¼“å­˜

    Outcome Evaluate(ExecutionContext& ctx, Bool& outValue) {
        Float currentHealth = ctx.GetOwner().GetStat(m_statType);
        outValue = (currentHealth < m_value);
        return Outcome::Success;
    }
};

// è¿è¡Œæ—¶å®ä¾‹ï¼ˆInstanceï¼‰
class StatConditionInstance {
    CompiledStatCondition* m_compiled;  // æŒ‡å‘å…±äº«çš„ç¼–è¯‘æ•°æ®

    // å®ä¾‹ç‰¹å®šçŠ¶æ€ï¼ˆå¯é€‰çš„ç¼“å­˜ï¼‰
    Float m_lastHealthValue = -1.0f;
    Bool m_lastResult = false;

    Outcome Evaluate(ExecutionContext& ctx, Bool& outValue) {
        Float currentHealth = ctx.GetOwner().GetStat(m_compiled->m_statType);

        // ä¼˜åŒ–ï¼šå¦‚æœè¡€é‡æ²¡å˜ï¼Œè¿”å›ç¼“å­˜çš„ç»“æœ
        if (m_lastHealthValue == currentHealth) {
            outValue = m_lastResult;
            return Outcome::Cached;
        }

        m_lastHealthValue = currentHealth;
        m_lastResult = (currentHealth < m_compiled->m_value);
        outValue = m_lastResult;
        return Outcome::Success;
    }
};
```

### 5.4 æ¡ä»¶ç¼“å­˜ä¼˜åŒ–

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameAI/include/aiTweakActionSystem.h:81-87`

```cpp
#if RED_CTSW(RED_AI_TWEAK_ACTION_PREDICTION_OPTIMIZATION)
    RED_INLINE static constexpr Bool IsConditionCachingEnabled() {
        return true;
    }
#endif
```

**ç¼“å­˜ç­–ç•¥**ï¼š

#### 1. äº‹ä»¶é©±åŠ¨å¤±æ•ˆ

```cpp
// å½“ç›¸å…³æ•°æ®å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨å¤±æ•ˆç¼“å­˜
class StatCondition {
    virtual Bool IsEventDriven() const override {
        return true;  // ç›‘å¬StatChangedäº‹ä»¶
    }

    virtual void OnEvent(Event& event) override {
        if (event.Is<StatChangedEvent>()) {
            InvalidateCache();  // å¤±æ•ˆç¼“å­˜
        }
    }
};
```

#### 2. æ—¶é—´å¤±æ•ˆ

```cpp
struct CachedResult {
    Bool m_value;
    Float m_timestamp;
    Float m_ttl = 0.5f;  // ç¼“å­˜æœ‰æ•ˆæœŸ0.5ç§’

    Bool IsValid(Float currentTime) const {
        return (currentTime - m_timestamp) < m_ttl;
    }
};
```

### 5.5 çŸ­è·¯è¯„ä¼°ä¼˜åŒ–

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameAI/include/aiTweakActionSystem.h:73-79`

```cpp
RED_INLINE static constexpr Bool IsShortcircuitEvaluationEnabled() {
    return true;
}
```

**åº”ç”¨ç¤ºä¾‹**ï¼š

```cpp
// TweakDB: ANDæ¡ä»¶ç»„åˆ
AIAction.AttackCondition = {
    type: "AND",
    conditions: [
        "HasWeapon",           // å¿«é€Ÿæ£€æŸ¥
        "CanSeeTarget",        // ä¸­ç­‰ä»£ä»·
        "HasLineOfSight",      // æ˜‚è´µçš„å°„çº¿æ£€æµ‹
    ]
}

// çŸ­è·¯è¯„ä¼°ä¼˜åŒ–
Bool EvaluateANDCondition(ExecutionContext& ctx) {
    if (!EvaluateCondition(ctx, "HasWeapon"))
        return false;  // çŸ­è·¯ï¼šæ²¡æ­¦å™¨å°±ä¸ç”¨ç»§ç»­æ£€æŸ¥äº†

    if (!EvaluateCondition(ctx, "CanSeeTarget"))
        return false;  // çŸ­è·¯ï¼šçœ‹ä¸è§ç›®æ ‡

    if (!EvaluateCondition(ctx, "HasLineOfSight"))
        return false;  // æœ€åæ‰åšæ˜‚è´µçš„å°„çº¿æ£€æµ‹

    return true;
}
```

**æ€§èƒ½æå‡**ï¼š
- ğŸš€ **å‡å°‘æ— æ•ˆè®¡ç®—**ï¼šç¬¬ä¸€ä¸ªæ¡ä»¶å¤±è´¥ç«‹å³è¿”å›
- ğŸ¯ **æ™ºèƒ½æ’åº**ï¼šå°†å¿«é€Ÿæ£€æŸ¥æ”¾åœ¨å‰é¢
- ğŸ’¡ **æ¡ä»¶é‡æ’**ï¼šç¼–è¯‘æ—¶å¯ä»¥æ ¹æ®ä»£ä»·æ’åºæ¡ä»¶

---

## å…­ã€å®é™…åº”ç”¨æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹1ï¼šNPCæˆ˜æ–—å†³ç­–æµç¨‹

**å®Œæ•´çš„AIå†³ç­–é“¾**ï¼š

```
1. è¡Œä¸ºæ ‘æ ¹èŠ‚ç‚¹ (Root Behavior Tree)
       â”‚
       â–¼
2. å†³ç­–èŠ‚ç‚¹ (Decision Node)
       â”‚
       â”œâ”€â–º è¯„ä¼°æ¡ä»¶: "CanAttack" (TweakDB)
       â”‚   â””â”€â–º TweakActionSystem.EvaluateCondition()
       â”‚       â”œâ”€â–º HasWeaponæ¡ä»¶
       â”‚       â”œâ”€â–º CanSeeTargetæ¡ä»¶
       â”‚       â””â”€â–º IsInRangeæ¡ä»¶
       â”‚
       â”œâ”€â–º è¯„ä¼°ç›®æ ‡: "PrimaryTarget" (TweakDB)
       â”‚   â””â”€â–º TweakActionSystem.EvaluateTarget()
       â”‚       â””â”€â–º è¿”å›: game::Object* (ç©å®¶)
       â”‚
       â–¼
3. åŠ¨ä½œèŠ‚ç‚¹ (Action Node)
       â”‚
       â””â”€â–º åˆ›å»ºå‘½ä»¤: AttackCommand
           â”‚
           â–¼
4. å‘½ä»¤é˜Ÿåˆ— (Command Queue)
       â”‚
       â”œâ”€â–º Enqueue(AttackCommand)
       â””â”€â–º StartExecuting(AttackCommand, contextMask)
           â”‚
           â–¼
5. åŠ¨ä½œæ‰§è¡Œ (Action Execution)
       â”‚
       â”œâ”€â–º MoveToPosition (ç§»åŠ¨åˆ°å°„å‡»ä½ç½®)
       â”œâ”€â–º RotateTo (è½¬å‘ç›®æ ‡)
       â”œâ”€â–º PlayAnimation (æ’­æ”¾å°„å‡»åŠ¨ç”»)
       â””â”€â–º SpawnProjectile (ç”Ÿæˆå­å¼¹)
```

### æ¡ˆä¾‹2ï¼šUseWorkspotNodeçš„æ·±åº¦é›†æˆ

å›é¡¾ä¹‹å‰åˆ†æçš„ `useWorkspotNode.cpp`ï¼Œç°åœ¨å¯ä»¥çœ‹åˆ°å®ƒå¦‚ä½•é›†æˆåˆ°æ•´ä¸ªAIç³»ç»Ÿï¼š

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameQuest/src/useWorkspotNode.cpp`

```cpp
// UseWorkspotNode ä½¿ç”¨äº†æ‰€æœ‰æ ¸å¿ƒç³»ç»Ÿ

// 1. å‘½ä»¤ç³»ç»Ÿé›†æˆ
NodeResult UseWorkspotNodeDefinition::OnExecute(...) {
    // åˆ›å»º UseWorkspotCommand
    AI::CommandPtr cmd = m_params->DoCreateCommand(context);

    // å…¥é˜Ÿå‘½ä»¤
    context.GetCommandQueue().Enqueue(nullptr, cmd);

    // 2. ç›‘å¬å™¨åŒ…è£…å™¨ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰
    auto eventListener = red::CreateSharedPtr<StopWorkspotListenerWrapper>(
        executionContext, entId, ...
    );

    // 3. æ³¨å†Œåˆ°æ‰§è¡Œä¸Šä¸‹æ–‡
    executionContext.RegisterEvent(GetExtendedId(), GetEventName(), eventListener);

    return NodeResult::StayInNode;  // ç­‰å¾…å¼‚æ­¥å®Œæˆ
}

// 4. å·¥ä½œç‚¹ç›‘å¬å™¨å®ç°
void WorkspotListener::OnAnimationFinished(...) {
    if (auto wrapper = m_wrapper.Lock()) {
        // 5. çŠ¶æ€å˜åŒ–é€šçŸ¥
        if (wrapper->GetFunction() == UseWorkspotNodeFunctions::UseWorkspot) {
            wrapper->OnAnimationFinished(puppetID, entryId, flags, animationName, fastForward);
        }

        // 6. é€šçŸ¥è¡Œä¸ºæ ‘èŠ‚ç‚¹
        wrapper->SetFulfilled(true);
        wrapper->NotifyAboutEvent();  // è§¦å‘èŠ‚ç‚¹çš„OnExecuteå†æ¬¡è°ƒç”¨
    }
}

// 7. è¡Œä¸ºæ ‘èŠ‚ç‚¹å“åº”
NodeResult UseWorkspotNodeDefinition::OnExecute(...) {
    // ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ˆç”±äº‹ä»¶è§¦å‘ï¼‰
    StopWorkspotListenerWrapper* listener = FindEventListener(executionContext);

    if (listener->IsFulfilled()) {
        // 8. æ¸…ç†å’Œå®Œæˆ
        UnregisterEvent(executionContext);
        return OnCommandSuccess(executionContext, outputSockets);
    }

    return NodeResult::StayInNode;  // ç»§ç»­ç­‰å¾…
}
```

**ç³»ç»Ÿåä½œæµç¨‹å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Behavior Tree   â”‚
â”‚  UseWorkspot    â”‚
â”‚     Node        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1. CreateCommand()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Command Queue   â”‚â—„â”€â”€â”€â”
â”‚                 â”‚    â”‚ 7. Callback
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚ 2. Execute  â”‚
         â–¼             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ Workspot System â”‚    â”‚
â”‚                 â”‚â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 3. PlayAnimation
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Animation       â”‚
â”‚ System          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 4. OnAnimationFinished
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Workspot        â”‚
â”‚ Listener        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 5. NotifyEvent
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Event Listener  â”‚
â”‚ Wrapper         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 6. SetFulfilled()
         â–¼
    [å›åˆ°è¡Œä¸ºæ ‘]
```

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯æ€»ç»“

### 7.1 å†…å­˜æ± ç®¡ç†

æ‰€æœ‰AIå¯¹è±¡ä½¿ç”¨ä¸“ç”¨å†…å­˜æ± ï¼š

```cpp
RED_USE_MEMORY_POOL(AI::PoolAI_Behaviour);     // è¡Œä¸ºå¯¹è±¡
RED_USE_MEMORY_POOL(AI::PoolAI_Instances);     // è¡Œä¸ºå®ä¾‹
RED_USE_MEMORY_POOL(AI::PoolAI_TweakActions);  // TweakDBåŠ¨ä½œ
RED_USE_MEMORY_POOL(AI::PoolAI_Vehicles);      // è½¦è¾†AI
```

**ä¼˜åŠ¿**ï¼š
- âœ… **å‡å°‘å†…å­˜ç¢ç‰‡**ï¼šåŒç±»å‹å¯¹è±¡é›†ä¸­åˆ†é…
- âœ… **æé«˜ç¼“å­˜å‘½ä¸­ç‡**ï¼šç›¸å…³æ•°æ®ç´§å¯†æ’åˆ—
- âœ… **å¿«é€Ÿåˆ†é…/é‡Šæ”¾**ï¼šæ± åŒ–å‡å°‘ç³»ç»Ÿè°ƒç”¨

### 7.2 LODï¼ˆç»†èŠ‚å±‚æ¬¡ï¼‰ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiEnvironment.h:103-104`

```cpp
virtual LODType GetLOD() const = 0;
virtual const ent::EntityLODContext GetLODContext() const = 0;
```

**LODç­‰çº§å½±å“AIæ›´æ–°é¢‘ç‡**ï¼š

```cpp
Uint32 GetAIComponentTickRate(LODType lod) {
    switch (lod) {
        case LOD::LOD0:  return 1;   // æ¯å¸§æ›´æ–° (ç©å®¶é™„è¿‘)
        case LOD::LOD1:  return 2;   // æ¯2å¸§æ›´æ–°
        case LOD::LOD2:  return 4;   // æ¯4å¸§æ›´æ–°
        case LOD::LOD3:  return 8;   // æ¯8å¸§æ›´æ–° (è¿œå¤„NPC)
        default:         return 16;  // æè¿œNPC
    }
}
```

### 7.3 é€‰æ‹©æ€§æ›´æ–°é˜Ÿåˆ—

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiBehaviorInstance.h:141-147`

```cpp
struct UpdateQueueItem {
    Bool m_isLive : 1;       // æ ‡è®°åˆ é™¤ï¼ˆé¿å…æ•°ç»„é‡æ’ï¼‰
    Bool m_onlyOnce : 1;     // ä¸€æ¬¡æ€§æ›´æ–°
    const Updatable* m_updatable;
};
```

**ä¼˜åŒ–ç­–ç•¥**ï¼š
- åªæœ‰éœ€è¦Updateçš„èŠ‚ç‚¹æ‰åŠ å…¥é˜Ÿåˆ—
- åˆ é™¤èŠ‚ç‚¹æ—¶åªæ ‡è®°`m_isLive = false`ï¼Œé¿å…æ•°ç»„å…ƒç´ ç§»åŠ¨
- æ”¯æŒä¸€æ¬¡æ€§æ›´æ–°èŠ‚ç‚¹ï¼ˆ`onlyOnce`ï¼‰

### 7.4 ç¼–è¯‘æ—¶å¼€å…³

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameAI/include/aiTweakActionSystem.h:65-87`

```cpp
#if RED_CTSW(RED_AI_TWEAK_ACTION_SYSTEM_ENABLED)
    // ç³»ç»Ÿå¯ç”¨/ç¦ç”¨
#endif

#if RED_CTSW(RED_AI_TWEAK_ACTION_SHORTCIRCUIT_EVALUATION)
    // çŸ­è·¯è¯„ä¼°ä¼˜åŒ–
#endif

#if RED_CTSW(RED_AI_TWEAK_ACTION_PREDICTION_OPTIMIZATION)
    // æ¡ä»¶ç¼“å­˜ä¼˜åŒ–
#endif
```

**æ ¹æ®å¹³å°å’Œé…ç½®ç¼–è¯‘ä¸åŒç‰ˆæœ¬**ï¼š
- Consoleï¼ˆä¸»æœºï¼‰ï¼šæ‰€æœ‰ä¼˜åŒ–å¼€å¯
- PC Low Settingsï¼šéƒ¨åˆ†ä¼˜åŒ–
- PC Ultra Settingsï¼šå…¨éƒ¨åŠŸèƒ½å¼€å¯

---

## å…«ã€è°ƒè¯•å’Œå¼€å‘å·¥å…·

### 8.1 è¡Œä¸ºè°ƒè¯•å™¨

**ç›¸å…³æ–‡ä»¶**ï¼š
- `common/ai/include/aiBehaviorDebugger.h`
- `common/ai/include/behaviorDebuggerConnection.h`
- `common/ai/include/behaviorDebuggerCommands.h`

```cpp
class Debugger {
    // è¿œç¨‹è°ƒè¯•æ”¯æŒ
    void OnBreakpoint(...);
    void StepInto();
    void StepOver();
    void Continue();

    // å¯è§†åŒ–
    void RenderTreeState();
    void RenderActiveNodes();
};
```

### 8.2 è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiEnvironment.h:120-122`

```cpp
#if RED_CTSW(RED_AI_DEBUG_LOG_ENABLED)
    AI::DebugLog* Debug_GetAILog(Bool create = true) const;
#endif
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```cpp
AI_LOG(ctx.GetEnvironment(), "Starting attack command on %s",
       targetName.AsChar());
```

### 8.3 ImGuiå®æ—¶è°ƒè¯•

**ç›¸å…³æ–‡ä»¶**ï¼š
- `common/ai/include/aiCommandQueue.h:200+`
- `common/gameAI/include/aiTweakActionSystem.h:44`

```cpp
#ifdef RED_USE_IMGUI
    void RenderDebugUI();  // å®æ—¶æ˜¾ç¤ºå‘½ä»¤é˜Ÿåˆ—çŠ¶æ€
#endif

virtual void OnRenderDebug(const RenderDebugContext& context) override;
```

**è°ƒè¯•ç•Œé¢æ˜¾ç¤º**ï¼š
- å½“å‰æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤
- å‘½ä»¤é˜Ÿåˆ—å†…å®¹
- TweakDBæ¡ä»¶è¯„ä¼°ç»“æœ
- è¡Œä¸ºæ ‘èŠ‚ç‚¹æ¿€æ´»çŠ¶æ€

---

## ä¹ã€çº¿ç¨‹å®‰å…¨å’Œå¹¶å‘

### 9.1 è¯»å†™é”ä¿æŠ¤

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameAI/include/aiTweakActionSystem.h:148, 181-182`

```cpp
// ç¼–è¯‘è®°å½•ç¼“å­˜
red::HashMap<game::data::TweakDBID, CompiledRecordPtr> m_compiledRecords;
mutable red::RWSpinLock m_compiledRecordsLock;

// å®ä½“æ¡ç›®
struct EntityEntry {
    red::HashMap<game::data::TweakDBID, InstancePtr> m_instances;
    mutable red::RWSpinLock m_lock;
};
```

**å¹¶å‘è®¿é—®æ¨¡å¼**ï¼š
```cpp
// å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–ï¼ˆå…±äº«é”ï¼‰
{
    RED_SCOPE_SHARED_LOCK(m_compiledRecordsLock);
    auto* compiled = m_compiledRecords.FindPtr(id);
}

// å†™å…¥æ—¶ç‹¬å 
{
    RED_SCOPE_LOCK(m_compiledRecordsLock);
    m_compiledRecords.Insert(id, compiledRecord);
}
```

### 9.2 åŸå­æ“ä½œ

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameAI/include/aiTweakActionSystem.h:183`

```cpp
struct EntityEntry {
    red::Atomic<Bool> m_isAlive;  // åŸå­æ ‡å¿—
};
```

**æ— é”æ£€æŸ¥**ï¼š
```cpp
if (entry->m_isAlive.GetValue()) {
    // å¿«é€Ÿæ£€æŸ¥ï¼Œæ— éœ€é”
}
```

### 9.3 å›è°ƒé›†åˆçš„çº¿ç¨‹å®‰å…¨

**æ–‡ä»¶ä½ç½®ï¼š** `common/ai/include/aiCommandQueue.h:64-145`

```cpp
template<typename TCallback, typename CallbackIdType = Uint32>
class CallbackSet {
    TCallbackId Add(TCallback callback) {
        RED_SCOPE_LOCK(m_callbacksLock);  // å†™é”
        m_entries.PushBack({id, callback});
        return id;
    }

    void Invoke(TArgs&&... args) {
        // 1. å¤åˆ¶å›è°ƒåˆ—è¡¨ï¼ˆåœ¨é”å†…ï¼‰
        red::DynArray<Entry> callbacks{red::PoolFrame()};
        {
            RED_SCOPE_LOCK(m_callbacksLock);
            for (auto& entry : m_entries) {
                if (entry.m_id != 0) {
                    callbacks.PushBack(entry);
                }
            }
        }

        // 2. è°ƒç”¨å›è°ƒï¼ˆåœ¨é”å¤–ï¼Œé¿å…æ­»é”ï¼‰
        for (const auto& entry : callbacks) {
            entry.m_callback(args...);
        }
    }
};
```

**è®¾è®¡è¦ç‚¹**ï¼š
- âœ… é¿å…åœ¨å›è°ƒæ‰§è¡Œæ—¶æŒæœ‰é”ï¼ˆé˜²æ­¢æ­»é”ï¼‰
- âœ… å¤åˆ¶å›è°ƒåˆ—è¡¨åˆ°æ ˆå†…å­˜ï¼ˆ`PoolFrame`ï¼‰
- âœ… æ”¯æŒå›è°ƒä¸­ç§»é™¤è‡ªå·±

---

## åã€æ€»ç»“ï¼šAIè¡Œä¸ºç³»ç»Ÿçš„è®¾è®¡å“²å­¦

### 10.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

| åŸåˆ™ | å®ç° | ä¼˜åŠ¿ |
|------|------|------|
| **æ•°æ®é©±åŠ¨** | TweakDBé…ç½®æ‰€æœ‰AIè¡Œä¸º | ç­–åˆ’æ— éœ€ç¼–ç¨‹å³å¯è°ƒæ•´AI |
| **æ¨¡å—åŒ–** | è¡Œä¸ºæ ‘ã€å‘½ä»¤ã€åŠ¨ä½œä¸‰å±‚åˆ†ç¦» | æ˜“äºæ‰©å±•å’Œç»´æŠ¤ |
| **å¼‚æ­¥æ‰§è¡Œ** | å‘½ä»¤é˜Ÿåˆ—+å›è°ƒæœºåˆ¶ | æµç•…çš„æ¸¸æˆä½“éªŒ |
| **æ€§èƒ½ä¼˜å…ˆ** | LODã€ç¼“å­˜ã€å†…å­˜æ± ã€ç¼–è¯‘ä¼˜åŒ– | æ”¯æŒå¤§é‡NPCåŒæ—¶è¿è¡Œ |
| **å¯è°ƒè¯•æ€§** | å®Œæ•´çš„è°ƒè¯•å™¨å’Œæ—¥å¿—ç³»ç»Ÿ | å¿«é€Ÿå®šä½é—®é¢˜ |
| **çº¿ç¨‹å®‰å…¨** | è¯»å†™é”ã€åŸå­æ“ä½œ | å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œ |

### 10.2 æŠ€æœ¯äº®ç‚¹

#### 1. ä¸‰å±‚æŠ½è±¡çš„TweakDBé›†æˆ
```
Raw Data â†’ Compiled Record â†’ Runtime Instance
(ç£ç›˜)       (å…¨å±€ç¼“å­˜)        (æ¯NPCç¼“å­˜)
```

#### 2. å¤šä¸Šä¸‹æ–‡å‘½ä»¤å¹¶è¡Œ
```cpp
NPCå¯ä»¥åŒæ—¶ï¼š
- ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½® (Movement Context)
- ä½¿ç”¨å·¥ä½œç‚¹åä¸‹  (Workspot Context)
- ç„å‡†ç©å®¶        (Aiming Context)
```

#### 3. æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- äº‹ä»¶é©±åŠ¨å¤±æ•ˆ
- æ—¶é—´æˆ³TTL
- çŸ­è·¯è¯„ä¼°

#### 4. å®Œå–„çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
```
Activate â†’ Update â†’ Deactivate
           â†“
        Interrupt (ä»»ä½•æ—¶å€™å¯ä»¥ä¸­æ–­)
```

### 10.3 è§„æ¨¡åŒ–èƒ½åŠ›

**æ–‡ä»¶ç»Ÿè®¡**ï¼š
- **134ä¸ª** AIåŸºç¡€å¤´æ–‡ä»¶
- **181ä¸ª** GameAIå¤´æ–‡ä»¶
- **32ä¸ª** TweakDB Recordsåˆ†ç‰‡
- **100+** åŠ¨ä½œç±»å‹

**æ”¯æ’‘çš„åœºæ™¯è§„æ¨¡**ï¼š
- åŒå±æ•°ç™¾ä¸ªNPC
- å¤æ‚çš„ç¤¾åŒºAIï¼ˆå·¥ä½œã€å·¡é€»ã€ååº”ï¼‰
- é«˜çº§æˆ˜æ–—AIï¼ˆæ©ä½“ã€æˆ˜æœ¯ã€å›¢é˜Ÿåä½œï¼‰
- è½¦è¾†AIï¼ˆäº¤é€šæµã€è¿½é€ã€ç«é€Ÿï¼‰

### 10.4 ä¸ä¼ ç»ŸAIç³»ç»Ÿçš„å¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»Ÿåšæ³• | èµ›åšæœ‹å…‹2077 |
|------|---------|--------------|
| **é…ç½®æ–¹å¼** | ç¡¬ç¼–ç  | TweakDBæ•°æ®é©±åŠ¨ |
| **å¹¶å‘æ‰§è¡Œ** | å•ä¸€çŠ¶æ€æœº | å¤šä¸Šä¸‹æ–‡å¹¶è¡Œ |
| **æ€§èƒ½ä¼˜åŒ–** | æ‰‹åŠ¨ä¼˜åŒ– | è‡ªåŠ¨LOD+ç¼“å­˜ |
| **è°ƒè¯•** | printfè°ƒè¯• | å®Œæ•´å¯è§†åŒ–è°ƒè¯•å™¨ |
| **æ‰©å±•æ€§** | ä¿®æ”¹ä»£ç  | æ·»åŠ é…ç½® |

---

## åä¸€ã€ä¸UseWorkspotNodeçš„å®Œæ•´å…³è”

### 11.1 ç³»ç»Ÿé›†æˆå±•ç¤º

**æ–‡ä»¶ä½ç½®ï¼š** `common/gameQuest/src/useWorkspotNode.cpp`

ç°åœ¨å›çœ‹ `useWorkspotNode.cpp`ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å®Œç¾èå…¥æ•´ä¸ªAIç”Ÿæ€ç³»ç»Ÿï¼š

```cpp
// 1. è¡Œä¸ºæ ‘èŠ‚ç‚¹å±‚ (Behavior Tree Node)
class UseWorkspotNodeDefinition : public AICommandNodeBase
{
    // å®ç° CTreeNode æ¥å£
    virtual NodeResult OnExecute(...) const override;
};

// 2. å‘½ä»¤å±‚ (Command Layer)
AI::CommandPtr cmd = CreateHandle<AI::UseWorkspotCommand>();
cmd->SetWorkspotNode(m_workspotNode);  // TweakDBå¼•ç”¨

// 3. å‘½ä»¤é˜Ÿåˆ—å±‚ (Command Queue)
context.GetCommandQueue().Enqueue(nullptr, cmd);

// 4. ç¯å¢ƒæ¥å£å±‚ (Environment Interface)
IEnvironment& env = context.GetEnvironment();
env.StartExecutingCommand(...);

// 5. äº‹ä»¶ç›‘å¬å±‚ (Event Listener)
class StopWorkspotListenerWrapper : public EventListenerWrapper {
    void OnAnimationFinished(...) {
        // é€šçŸ¥è¡Œä¸ºæ ‘èŠ‚ç‚¹
        SetFulfilled(true);
        NotifyAboutEvent();
    }
};

// 6. Workspotç³»ç»Ÿé›†æˆ (Workspot System)
work::WorkspotSystem* workspotSystem = context.GetWorkspotSystem();
workspotSystem->SendOrCacheCommand(entityId, m_oriId, work::CMD_EventListener, ...);

// 7. TweakDBå‚æ•°ç³»ç»Ÿ (TweakDB Parameters)
work::WorkspotParams workspotParams = m_params->GetWorkspotParams(executionContext, entId);
```

### 11.2 å®Œæ•´æ•°æ®æµ

```
TweakDB â†’ Behavior Tree â†’ Command Queue â†’ Workspot System
   â†“           â†“                â†“                â†“
é…ç½®æ•°æ®    å†³ç­–é€»è¾‘        å¼‚æ­¥æ‰§è¡Œ        åŠ¨ç”»æ’­æ”¾
                                â†“
                          Event Listener
                                â†“
                        Behavior Tree (å®Œæˆ)
```

### 11.3 ä¼˜åŠ¿æ€»ç»“

UseWorkspotNode å®Œç¾å±•ç¤ºäº†æ•´ä¸ªAIç³»ç»Ÿçš„è®¾è®¡ä¼˜åŠ¿ï¼š

| å±‚é¢ | å®ç° | ä¼˜åŠ¿ |
|------|------|------|
| **é…ç½®** | TweakDBå‚æ•° | ç­–åˆ’å¯é…ç½®å·¥ä½œç‚¹å‚æ•° |
| **å†³ç­–** | è¡Œä¸ºæ ‘èŠ‚ç‚¹ | é€»è¾‘æ¸…æ™°å¯è§†åŒ– |
| **æ‰§è¡Œ** | å‘½ä»¤é˜Ÿåˆ— | å¼‚æ­¥éé˜»å¡ |
| **ç›‘å¬** | äº‹ä»¶ç³»ç»Ÿ | æ¾è€¦åˆé€šçŸ¥ |
| **å¹³æ»‘** | è‡ªåŠ¨å¤„ç†åˆ‡æ¢ | é¿å…ç©¿æ¨¡ |
| **å®¹é”™** | åŠ¨ç”»ç¼ºå¤±å¤„ç† | ä¸ä¼šå¡æ­»ä»»åŠ¡ |

---

## é™„å½•ï¼šå…³é”®æ–‡ä»¶ç´¢å¼•

### A. æ ¸å¿ƒAIæ¡†æ¶ (common/ai/include/)

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| **aiTreeNode.h** | è¡Œä¸ºæ ‘èŠ‚ç‚¹åŸºç±» |
| **aiBehaviorInstance.h** | è¡Œä¸ºå®ä¾‹ç®¡ç† |
| **aiCommand.h** | å‘½ä»¤åŸºç±»å®šä¹‰ |
| **aiCommandQueue.h** | å‘½ä»¤é˜Ÿåˆ—ç³»ç»Ÿ |
| **aiEnvironment.h** | ç¯å¢ƒæ¥å£ |
| **aiBehaviorDebugger.h** | è°ƒè¯•å™¨ |

### B. æ¸¸æˆAIå®ç° (common/gameAI/include/)

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| **aiTweakActionSystem.h** | TweakDBåŠ¨ä½œè¯„ä¼°ç³»ç»Ÿ |
| **aiTreeNodeAction.h** | åŠ¨ä½œèŠ‚ç‚¹ |
| **aiTreeNodeDecision.h** | å†³ç­–èŠ‚ç‚¹ |
| **aiTreeNodeFSM.h** | æœ‰é™çŠ¶æ€æœºèŠ‚ç‚¹ |
| **aiSystemImpl.h** | AIç³»ç»Ÿä¸»å®ç° |

### C. TweakDBé…ç½® (common/gameTweakDB/include/)

| æ–‡ä»¶ç±»å‹ | æ•°é‡ | åŠŸèƒ½ |
|---------|------|------|
| **tweakDBRecords_XX.cpp** | 32ä¸ªåˆ†ç‰‡ | AIè®°å½•å®šä¹‰ |
| **tweakDBInterface_XX.cpp** | 32ä¸ªåˆ†ç‰‡ | è„šæœ¬æ¥å£ |
| **tweakDBEnums_XX.cpp** | 15ä¸ªåˆ†ç‰‡ | æšä¸¾ç±»å‹ |

### D. ç¼–è¾‘å™¨åç«¯ (backend/)

| ç›®å½• | åŠŸèƒ½ |
|------|------|
| **backendAI/** | AIç¼–è¾‘å™¨åç«¯ |
| **backendBehavior/** | è¡Œä¸ºç¼–è¾‘å™¨åç«¯ |
| **backendGame/** | æ¸¸æˆç¼–è¾‘å™¨åç«¯ |

---

## ç»“è¯­

ã€Šèµ›åšæœ‹å…‹2077ã€‹çš„AIè¡Œä¸ºç³»ç»Ÿä»£è¡¨äº†ç°ä»£3Aæ¸¸æˆAIæ¶æ„çš„æœ€é«˜æ°´å‡†ã€‚å®ƒé€šè¿‡**æ•°æ®é©±åŠ¨**ã€**æ¨¡å—åŒ–è®¾è®¡**ã€**æ€§èƒ½ä¼˜åŒ–**å’Œ**å®Œå–„çš„å·¥å…·é“¾**ï¼ŒæˆåŠŸæ”¯æ’‘äº†ä¸€ä¸ªæ‹¥æœ‰æ•°ç™¾ä¸ªæ´»è·ƒNPCçš„å¼€æ”¾ä¸–ç•Œã€‚

è¿™ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒå“²å­¦æ˜¯ï¼š
- **è®©ç­–åˆ’ä¸“æ³¨äºè®¾è®¡**ï¼ˆTweakDBé…ç½®ï¼‰
- **è®©ç¨‹åºå‘˜ä¸“æ³¨äºæ¶æ„**ï¼ˆæ¨¡å—åŒ–æ¡†æ¶ï¼‰
- **è®©AIè¡¨ç°æ›´åŠ è‡ªç„¶**ï¼ˆå¼‚æ­¥æ‰§è¡Œ+æ™ºèƒ½ç¼“å­˜ï¼‰
- **è®©è°ƒè¯•æ›´åŠ é«˜æ•ˆ**ï¼ˆå®Œæ•´çš„è°ƒè¯•å·¥å…·ï¼‰

é€šè¿‡æœ¬æ–‡çš„æ·±åº¦åˆ†æï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªå·¥ä¸šçº§AIç³»ç»Ÿçš„å®Œæ•´å®ç°ï¼Œè¿™å¯¹äºç†è§£ç°ä»£æ¸¸æˆå¼€å‘å…·æœ‰é‡è¦çš„å‚è€ƒä»·å€¼ã€‚

---

**æ–‡æ¡£ä¿¡æ¯**
- ä½œè€…ï¼šåŸºäºæºä»£ç åˆ†æç”Ÿæˆ
- ç‰ˆæœ¬ï¼š1.0
- æœ€åæ›´æ–°ï¼š2025-10-22
- æºä»£ç è·¯å¾„ï¼šE:\SoftApp\Sy2077\2077\2077\CDPR2077\dev\src
